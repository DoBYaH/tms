// Component: j-Exec
// Version: 1
// Updated: 2021-01-07 13:02
COMPONENT('exec',function(self,config){var regparent=/\?\d/;self.readonly();self.blind();self.make=function(){var scope=null,scopepath=function(el,val){if(!scope)scope=el.scope();return val==null?scope:scope?scope.makepath?scope.makepath(val):val.replace(/\?/g,el.scope().path):val};var fn=function(plus){return function(e){var el=$(this);var attr=el.attrd('exec'+plus);var path=el.attrd('path'+plus);var href=el.attrd('href'+plus);var def=el.attrd('def'+plus);var reset=el.attrd('reset'+plus);scope=null;var prevent=el.attrd('prevent'+plus);if(prevent==='true'||prevent==='1'){e.preventDefault();e.stopPropagation()}if(attr){if(attr.indexOf('?')!==-1){var tmp=scopepath(el);if(tmp){var isparent=regparent.test(attr);attr=tmp.makepath?tmp.makepath(attr):attr.replace(/\?/g,tmp.path);if(isparent&&attr.indexOf('/')!==-1)M.scope(attr.split('/')[0]);else M.scope(tmp.path)}}EXEC(attr,el,e)}href&&NAV.redirect(href);if(def){if(def.indexOf('?')!==-1)def=scopepath(el,def);DEFAULT(def)}if(reset){if(reset.indexOf('?')!==-1)reset=scopepath(el,reset);RESET(reset)}if(path){var val=el.attrd('value');if(val){if(path.indexOf('?')!==-1)path=scopepath(el,path);var v=GET(path);SET(path,new Function('value','return '+val)(v),true)}}}};self.event('dblclick',config.selector2||'.exec2',fn('2'));self.event('click',config.selector||'.exec',fn(''))}});
// End: j-Exec

// Component: j-Flow
// Version: 1
// Updated: 2021-05-11 14:20
COMPONENT('flow','width:6000;height:6000;grid:25;paddingX:6;curvedlines:0;horizontal:1;steplines:1;snapping:0;animationradius:6;outputoffsetY:10;outputoffsetX:12;inputoffsetY:10;inputoffsetX:12',function(self,config,cls){var D='__',drag={};self.readonly();self.meta={};self.el={};self.op={};self.cache={};self.paused={};self.animations={};self.animations_token=0;self.info={zoom:100};self.undo=[];self.redo=[];self.focused=null;self.make=function(){self.aclass(cls);self.html('<svg width="{width}" height="{height}" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="jflowgrid" width="{grid}" height="{grid}" patternunits="userSpaceOnUse"><path d="M {grid} 0 L 0 0 0 {grid}" fill="none" class="ui-flow-grid" shape-rendering="crispEdges" /></pattern></defs><rect width="100%" height="100%" fill="url(#jflowgrid)" shape-rendering="crispEdges" /><g class="lines"></g><g class="anim"></g></svg>'.arg(config));self.el.svg=self.find('svg');self.el.anim=self.el.svg.find('g.anim');self.el.lines=self.el.svg.find('g.lines');self.template=Tangular.compile('<div class="component invisible{{ if inputs && inputs.length}} hasinputs{{ fi}}{{ if outputs && outputs.length}} hasoutputs{{ fi}} f-{{ component}}" data-id="{{ id}}" style="top:{{ y}}px;left:{{ x}}px"><div class="area"><div class="content">{{ html | raw}}</div>{{ if inputs && inputs.length}}<div class="inputs">{{ foreach m in inputs}}<div class="input" data-index="{{ if m.id}}{{ m.id}}{{ else}}{{ $index}}{{ fi}}"><i class="component-io"></i><span>{{ if m.name}}{{ m.name | raw}}{{ else}}{{ m | raw}}{{ fi}}</span></div>{{ end}}</div>{{ fi}}{{ if outputs && outputs.length}}<div class="outputs">{{ foreach m in outputs}}<div class="output" data-index="{{ if m.id}}{{ m.id}}{{ else}}{{ $index}}{{ fi}}"><i class="component-io"></i><span>{{ if m.name}}{{ m.name | raw}}{{ else}}{{ m | raw}}{{ fi}}</span></div>{{ end}}</div>{{ fi}}</div></div>');self.aclass(cls+'-'+(config.horizontal?'h':'v'));drag.touchmove=function(e){var evt=e.touches[0];drag.lastX=evt.pageX;drag.lastY=evt.pageY};drag.touchend=function(e){e.target=document.elementFromPoint(drag.lastX,drag.lastY);if(e.target&&e.target.tagName!=='SVG')e.target=$(e.target).closest('svg')[0];drag.unbind();if(e.target){var pos=self.op.position();e.pageX=drag.lastX;e.pageY=drag.lastY;e.offsetX=e.pageX-pos.left;e.offsetY=e.pageY-pos.top;drag.drop(e)}};drag.bind=function(){$(document).on('touchmove',drag.touchmove).on('touchend',drag.touchend)};drag.unbind=function(){$(document).off('touchmove',drag.touchmove).off('touchend',drag.touchend)};drag.handler=function(e){if(HIDDEN(self.element))return;drag.el=$(e.target);e.touches&&drag.bind();var dt=e.originalEvent.dataTransfer;dt&&dt.setData('text','1')};drag.drop=function(e){var meta={};meta.pageX=e.pageX;meta.pageY=e.pageY;meta.offsetX=e.offsetX;meta.offsetY=e.offsetY;meta.el=drag.el;meta.target=$(e.target);config.ondrop&&self.EXEC(config.ondrop,meta,self)};$(document).on('dragstart','[draggable]',drag.handler).on('touchstart','[draggable]',drag.handler);self.el.svg.on('dragenter dragover dragexit drop dragleave',function(e){switch(e.type){case'drop':drag.drop(e);break}e.preventDefault()})};self.destroy=function(){$(document).off('dragstart',drag.handler)};self.getOffset=function(){return self.element.offset()};var rebuilding=false,rebuildagain=false;self.setter=function(value,path,type){if(rebuilding){rebuildagain=true;return}if(type===2||!value)return;var keys=Object.keys(value);var onmake=config.onmake?GET(self.makepath(config.onmake)):null;var ondone=config.ondone?GET(self.makepath(config.ondone)):null;var onremove=config.onremove?GET(self.makepath(config.onremove)):null;var prev=self.cache,ischanged=false,tmp,el,recompile=false;rebuilding=true;self.cache={};self.paused={};self.animations_token=Date.now();self.animations={};for(var i=0;i<keys.length;i++){var key=keys[i];if(key==='paused'){self.paused=value[key];continue}var com=value[key],checksum=self.helpers.checksum(com);var tmp=prev[key],rebuild=true;com.id=key;if(tmp){if(tmp.checksum===checksum)rebuild=false;delete prev[key];el=tmp.el}if(rebuild){tmp&&tmp.el.aclass('removed').attrd('id','removed');var html=self.template(com);if(!recompile&&html&&html.COMPILABLE())recompile=true;html=$(html);self.append(html);el=self.find('.component[data-id="{id}"]'.arg(com));com.onmake&&com.onmake(el,com);onmake&&onmake(el,com);com.element=html.find('.content').eq(0);if(!ischanged&&com.connections&&Object.keys(com.connections).length)ischanged=true;if(type===1)self.op.undo({type:'component',id:com.id,instance:com})}if(!com.connections)com.connections={};self.cache[key]={id:key,instance:com,el:el,checksum:checksum,actions:com.actions||{}}}var removedconn=[];for(var key in prev){tmp=prev[key];tmp.instance.onremove&&tmp.instance.onremove(tmp.el,tmp.instance);onremove&&onremove(tmp.el,tmp.instance);var conn=self.el.lines.find('.from'+D+key+',.to'+D+key).aclass('connection removed hidden');for(var i=0;i<conn.length;i++){var dom=conn[i];removedconn.push({fromid:dom.getAttribute('data-from'),fromindex:dom.getAttribute('data-fromindex'),toid:dom.getAttribute('data-to'),toindex:dom.getAttribute('data-toindex')})}tmp.el.remove()}for(var key in self.cache){tmp=self.cache[key];tmp.instance.ondone&&tmp.instance.ondone(tmp.el,tmp.instance);ondone&&ondone(tmp.el,tmp.instance)}self.el.lines.find('path').aclass('removed');keys=Object.keys(self.cache);setTimeout(function(){for(var i=0;i<keys.length;i++){var key=keys[i];tmp=self.cache[key];tmp.el.rclass('invisible');tmp.instance.connections&&self.reconnect(tmp)}self.find('.removed').remove();rebuilding=false;for(var i=0;i<removedconn.length;i++){var conn=removedconn[i];self.helpers.checkconnectedinput(conn.toid,conn.toindex);self.helpers.checkconnectedoutput(conn.fromid,conn.fromindex);var com=self.find('.component[data-id="'+conn.fromid+'"]');com.tclass('connected',self.el.lines.find('.from'+D+'_'+conn.fromid).length>0)}rebuildagain&&self.refresh();rebuildagain=false},300);self.undo=[];self.redo=[];self.op.undo();self.op.redo();self.op.refreshinfo();COMPILE()};self.reconnect=function(m){for(var index in m.instance.connections){var output=m.el.find('.output[data-index="{0}"]'.format(index));var inputs=m.instance.connections[index],problem=false;for(var j=0;j<inputs.length;j++){var com=inputs[j],el=self.find('.component[data-id="{0}"]'.format(com.id));var input=el.find('.input[data-index="{0}"]'.format(com.index));if(!self.el.connect(output,input,true)){inputs[j]=null;problem=true}}if(problem){index=0;while(true){var item=inputs[index];if(item===undefined)break;if(item===null)inputs.splice(index,1);else index++}}}};self.selected=function(callback){var output={},arr,tmp,el;output.components=[];output.connections=[];arr=self.find('.component-selected');for(var i=0;i<arr.length;i++){el=arr[i];tmp=self.cache[el.getAttribute('data-id')];tmp&&output.components.push(tmp)}arr=self.find('.connection-selected');for(var i=0;i<arr.length;i++){el=arr[i];var cls=el.getAttribute('class').split(' ');for(var j=0;j<cls.length;j++){var c=cls[j];if(c.substring(0,4+D.length)==='conn'+D){var a=c.split(D);var tmp={};tmp.output=self.cache[a[1]].instance;tmp.input=self.cache[a[2]].instance;tmp.fromid=a[1];tmp.toid=a[2];tmp.fromindex=a[3];tmp.toindex=a[4];output.connections.push(tmp)}}}callback&&callback(output);return output}});EXTENSION('flow:helpers',function(self,config){var D='__';self.helpers={};self.helpers.checksum=function(obj){var checksum=JSON.stringify({a:obj.outputs,b:obj.inputs,c:obj.html,d:obj.x,e:obj.y,f:obj.connections});return HASH(checksum,true)};self.helpers.connect=function(x1,y1,x4,y4,findex,tindex){if(tindex===-1)tindex=0;if(findex===-1)findex=0;var y=(y4-y1)/2;var x2=x1,y2=y1+y,x3=x4,y3=y1+y,s=' ';if(config.curvedlines)return self.helpers.diagonal(x1,y1,x4,y4);var paddingO=config.steplines?Math.ceil(15*((findex+1)/100)*50):15;var paddingI=config.steplines?Math.ceil(15*((tindex+1)/100)*50):15;var can=config.steplines&&Math.abs(x1-x4)>50&&Math.abs(y1-y4)>50;var builder=[];builder.push('M'+(x1>>0)+s+(y1>>0));if(config.horizontal){if(can)x2+=paddingO;x2+=paddingO*2;builder.push('L'+(x2>>0)+s+(y1>>0));if(can){if((x1!==x4||y1!==y4)){var d=Math.abs(paddingO-paddingI)/2>>0;y2+=d;builder.push('L'+(x2>>0)+s+(y2>>0));y3+=d;x3-=paddingI*3;builder.push('L'+(x3>>0)+s+(y3>>0))}x4-=paddingI}if(can)x4-=paddingI*2;else x4-=paddingI;builder.push('L'+(x4>>0)+s+(y4>>0));if(can)x4+=paddingI*2;x4+=paddingI}else if(can){if((x1!==x4||y1!==y4)){builder.push('L'+(x2>>0)+s+(y2>>0));builder.push('L'+(x3>>0)+s+(y3>>0))}}builder.push('L'+(x4>>0)+s+(y4>>0));return builder.join(s)};self.helpers.move1=function(x1,y1,conn,findex,tindex){var pos=conn.attrd('offset').split(',');conn.attr('d',self.helpers.connect(x1,y1,+pos[2],+pos[3],findex,tindex));conn.attrd('offset',x1+','+y1+','+pos[2]+','+pos[3])};self.helpers.checkconnected=function(meta){meta.el.tclass('connected',Object.keys(meta.instance.connections).length>0)};self.helpers.checkconnectedoutput=function(id,index){var is=!!self.el.lines.find('.from'+D+id+D+index).length;self.find('.component[data-id="{0}"]'.format(id)).find('.output[data-index="{0}"]'.format(index)).tclass('connected',is)};self.helpers.checkconnectedinput=function(id,index){var is=!!self.el.lines.find('.to'+D+id+D+index).length;self.find('.component[data-id="{0}"]'.format(id)).find('.input[data-index="{0}"]'.format(index)).tclass('connected',is)};self.helpers.move2=function(x4,y4,conn,findex,tindex){var pos=conn.attrd('offset').split(',');conn.attr('d',self.helpers.connect(+pos[0],+pos[1],x4,y4,findex,tindex));conn.attrd('offset',pos[0]+','+pos[1]+','+x4+','+y4)};self.helpers.isconnected=function(output,input){var co=output.closest('.component');var ci=input.closest('.component');var coid=self.cache[co.attrd('id')];var ciid=self.cache[ci.attrd('id')];if(coid.id===ciid.id)return true;if(coid.actions.disabled||coid.actions.connect===false||ciid.actions.disabled||ciid.actions.connect===false)return true;var el=$('.conn'+D+co.attrd('id')+D+ci.attrd('id')+D+output.attrd('index')+D+input.attrd('index'));return el.length>0};self.helpers.position=function(el,isout){var component=el.closest('.component');var pos=el.offset();var mainoffset=el.closest('.ui-flow').offset();var x=(pos.left-mainoffset.left)+(isout?config.outputoffsetX:config.inputoffsetX);var y=(pos.top-mainoffset.top)+(isout?config.outputoffsetY:config.inputoffsetY);if(config.horizontal){var zoom=self.info.zoom/100;if(isout)x+=(component.width()*zoom)-13}var id=component.attrd('id');var indexid=el.attrd('index');return{x:x>>0,y:y>>0,id:id,index:indexid,indexoffset:el.index()}};self.helpers.parseconnection=function(line){var arr=line.attr('class').split(' ');for(var i=0;i<arr.length;i++){if(arr[i].substring(0,4+D.length)==='conn'+D){var info=arr[i].split(D);var obj={};obj.fromid=info[1];obj.toid=info[2];obj.fromindex=info[3];obj.toindex=info[4];return obj}}};self.helpers.diagonal=function(x1,y1,x4,y4){if(config.horizontal)return'M'+x1+','+y1+'C'+((x1+x4)/2)+','+y1+' '+x4+','+((y1+y4)/2)+' '+x4+','+y4;else return'M'+x1+','+y1+'C'+x1+','+((y1+y4)/2)+' '+x4+','+((y1+y4)/2)+' '+x4+','+y4}});EXTENSION('flow:operations',function(self,config){var D='__';var removeconnections=function(next,removed){var connections=next.instance.connections,meta={},onremove=function(conn){var is=conn.id===removed.id;if(is){meta.output=next.instance;meta.input=removed.instance;meta.fromid=next.id;meta.toid=removed.id;meta.toindex=conn.index;next.instance.ondisconnect&&next.instance.ondisconnect.call(next.instance,meta);removed.instance.ondisconnect&&removed.instance.ondisconnect.call(removed.instance,meta);config.ondisconnect&&self.EXEC(config.ondisconnect,meta)}return is};for(var index in connections){var conn=connections[index];meta.fromindex=index;connections[index]=conn=conn.remove(onremove);if(conn.length===0){delete connections[index];self.helpers.checkconnectedoutput(next.id,index)}}self.helpers.checkconnected(next)};self.op.unselect=function(type){var cls='connection-selected';if(type==null||type==='connections'){self.el.lines.find('.'+cls).rclass(cls);self.el.lines.find('.highlight').rclass('highlight')}cls='component-selected';if(type==null||type==='component')self.find('.'+cls).rclass(cls);if(self.info.selected){self.info.selected=null;self.op.refreshinfo()}};self.op.modified=function(){self.change(true);self.update(true,2)};self.op.clean=function(){var model=self.get();for(var key in model){if(key==='paused'){var count=0;for(var subkey in model.paused){var tmp=subkey.split(D);if(!model[tmp[1]]||!model[tmp[1]].connections||!model[tmp[1]].connections[tmp[2]])delete model.paused[subkey];else count++}if(!count)delete model.paused;continue}var com=model[key];for(var subkey in com.connections){var tmp=model[key].connections[subkey],index=0;while(true){var conn=tmp[index];if(conn==null)break;if(!model[conn.id]||!model[conn.id].inputs){tmp.splice(index,1);continue}index++}if(!tmp.length)delete model[key].connections}}};self.op.remove=function(id,noundo){var tmp=self.cache[id];if(tmp==null||tmp.actions.remove===false)return false;tmp.instance.onremove&&tmp.instance.onremove(tmp.el,tmp.instance);config.onremove&&self.EXEC(config.onremove,tmp.el,tmp.instance);delete self.cache[id];delete self.get()[id];self.el.lines.find('.from'+D+id).remove();self.el.lines.find('.to'+D+id).remove();for(var key in self.cache)removeconnections(self.cache[key],tmp);var connections=tmp.instance.connections;for(var index in connections){var conns=connections[index];for(var j=0;j<conns.length;j++){var conn=conns[j];self.helpers.checkconnectedinput(conn.id,conn.index)}}if(!noundo)self.op.undo({type:'remove',id:id,instance:tmp.instance});self.find('.component[data-id="{0}"]'.format(id)).remove();self.op.modified();return true};self.op.select=function(id){var com=self.cache[id];if(com==null)return false;var cls='component-selected';self.find('.'+cls).rclass(cls);self.find('.component[data-id="{0}"]'.format(id)).aclass(cls);var connections=self.el.lines.find('.from{0},.to{0}'.format(D+id)).aclass('highlight');var parent=self.el.lines[0];for(var i=0;i<connections.length;i++){var dom=connections[i];parent.removeChild(dom);parent.appendChild(dom)}self.info.selected=com.instance;self.op.refreshinfo();return true};self.op.modify=function(instance,type){if(!instance.changes)instance.changes={};instance.changes[type]=1};self.op.disconnect=function(fromid,toid,fromindex,toindex,noundo){if(typeof(fromid)==='object'){var meta=fromid;toid=meta.toid;fromindex=meta.fromindex;toindex=meta.toindex;fromid=meta.fromid}var a=self.cache[fromid],b=self.cache[toid];if(!a||!b)return false;var ac=a.instance;self.op.modify(a.instance,'disconnect');self.op.modify(b.instance,'disconnect');toindex+='';fromindex+='';var conn=ac.connections[fromindex].findItem(function(conn){return conn.id===toid&&conn.index===toindex});if(!conn||conn.disabled)return false;ac.connections[fromindex].splice(ac.connections[fromindex].indexOf(conn),1);if(!ac.connections[fromindex].length)delete ac.connections[fromindex];if(!noundo)self.op.undo({type:'disconnect',fromid:fromid,toid:toid,fromindex:fromindex,toindex:toindex});self.el.lines.find('.conn{0}{1}{2}{3}'.format(D+fromid,D+toid,D+fromindex,D+toindex)).remove();self.op.modified();self.helpers.checkconnected(a);self.helpers.checkconnectedoutput(fromid,fromindex);self.helpers.checkconnectedinput(toid,toindex);return true};self.op.reposition=function(){var dzoom=self.info.zoom/100,dzoomoffset=((100-self.info.zoom)/10)+(self.info.zoom>100?1:-1);var zoom=function(val){return Math.ceil(val/dzoom)-dzoomoffset};self.el.lines.find('.connection').each(function(){var path=$(this);if(path.hclass('removed'))return;var meta=self.helpers.parseconnection(path);if(!meta)return;var output=self.find('.component[data-id="{0}"]'.format(meta.fromid)).find('.output[data-index="{0}"]'.format(meta.fromindex));if(!output.length)return;var input=self.find('.component[data-id="{0}"]'.format(meta.toid)).find('.input[data-index="{0}"]'.format(meta.toindex));if(!input.length)return;var a=self.helpers.position(output,true);var b=self.helpers.position(input);b.x-=config.paddingX;if(dzoom!==1){b.x=zoom(b.x);b.y=zoom(b.y);a.x=zoom(a.x);a.y=zoom(a.y)}path.attrd('offset',a.x+','+a.y+','+b.x+','+b.y);path.attrd('from',a.id);path.attrd('to',b.id);path.attrd('fromindex',a.index);path.attrd('toindex',b.index);path.attrd('fromindexoffset',a.indexoffset);path.attrd('toindexoffset',b.indexoffset);path.attr('d',self.helpers.connect(a.x,a.y,b.x,b.y,a.indexoffset,b.indexoffset))})};self.op.position=function(){var obj={},scroll=self.closest('.ui-scrollbar-area')[0];if(scroll){obj.scrollTop=scroll.scrollTop;obj.scrollLeft=scroll.scrollLeft}var offset=self.el.svg.offset();obj.left=offset.left;obj.top=offset.top;return obj};self.op.refreshinfo=function(){config.infopath&&self.SEEX(config.infopath,self.info)};self.op.undo=function(value){if(value){self.undo.push(value);if(self.undo.length>50)self.undo.shift()}config.undopath&&self.SEEX(config.undopath,self.undo)};self.op.redo=function(value){if(value){self.redo.push(value);if(self.redo.length>50)self.redo.shift()}config.redopath&&self.SEEX(config.redopath,self.redo)};self.op.resize=function(){setTimeout2(self.ID+'reposition',self.op.reposition,300)};self.on('resize + resize2',self.op.resize)});EXTENSION('flow:map',function(self,config){var events={},drag={};events.move=function(e){var x=(drag.x-e.pageX);var y=(drag.y-e.pageY);if(drag.target[0]){drag.target[0].scrollTop+=((y/6)/drag.zoom)>>0;drag.target[0].scrollLeft+=((x/6)/drag.zoom)>>0}};events.movetouch=function(e){events.move(e.touches[0])};events.up=function(){events.unbind()};events.bind=function(){if(!events.is){events.is=true;self.element.on('mouseup',events.up);self.element.on('mousemove',events.move);self.element.on('touchend',events.up);self.element.on('touchmove',events.movetouch)}};events.unbind=function(){if(events.is){events.is=false;self.element.off('mouseup',events.up);self.element.off('mousemove',events.move);self.element.off('touchend',events.up);self.element.off('touchmove',events.movetouch)}};self.event('contextmenu',function(e){events.is&&events.up();config.contextmenu&&self.SEEX(config.contextmenu,e,'map');e.preventDefault();e.stopPropagation()});self.event('mousedown touchstart',function(e){if(events.is){events.up();return}if(e.button||e.target.tagName!=='rect')return;var evt=e.touches?e.touches[0]:e,et=$(e.target);var target=et.closest('.ui-scrollbar-area');if(!target[0]){target=et.closest('.ui-viewbox');if(!target[0])return}drag.target=target;drag.zoom=self.info.zoom/100;drag.x=evt.pageX;drag.y=evt.pageY;events.bind();e.preventDefault();self.op.unselect()})});EXTENSION('flow:components',function(self,config){var D='__',events={},drag={},zoom=function(val){return Math.ceil(val/drag.zoom)-drag.zoomoffset};drag.css={};events.reposition=function(){for(var i=0;i<drag.output.length;i++){var conn=$(drag.output[i]);var pos=self.helpers.position(conn,true);var arr=self.el.lines.find('.from'+D+pos.id+D+pos.index);for(var j=0;j<arr.length;j++){var ce=$(arr[j]);var findex=+ce.attrd('fromindexoffset');var tindex=+ce.attrd('toindexoffset');self.helpers.move1(zoom(pos.x+drag.zoomoffset),zoom(pos.y),ce,findex,tindex)}}for(var i=0;i<drag.input.length;i++){var conn=$(drag.input[i]);var pos=self.helpers.position(conn);var arr=self.el.lines.find('.to'+D+pos.id+D+pos.index);var findex=+conn.attrd('fromindexoffset');var tindex=+conn.attrd('toindexoffset');for(var j=0;j<arr.length;j++){var ce=$(arr[j]);var findex=+ce.attrd('fromindexoffset');var tindex=+ce.attrd('toindexoffset');self.helpers.move2(zoom(pos.x-6),zoom(pos.y),ce,findex,tindex)}}};events.move=function(e){var x=(e.pageX-drag.x);var y=(e.pageY-drag.y);drag.css.left=zoom(drag.posX+x);drag.css.top=zoom(drag.posY+y);if(!drag.is)drag.is=true;drag.target.css(drag.css);events.reposition()};events.movetouch=function(e){events.move(e.touches[0])};events.up=function(){if(drag.is){if(config.snapping){drag.css.left=drag.css.left-(drag.css.left%config.snapping);drag.css.top=drag.css.top-(drag.css.top%config.snapping);drag.target.css(drag.css);events.reposition()}var data=self.get()[drag.id];self.op.undo({type:'move',id:drag.id,x:data.x,y:data.y,newx:drag.css.left,newy:drag.css.top});data.x=drag.css.left;data.y=drag.css.top;data.onmove&&data.onmove(drag.target,data);config.onmove&&self.EXEC(config.onmove,drag.target,data);self.op.modified();self.op.modify(data,'move')}events.unbind()};events.bind=function(){if(!events.is){events.is=true;self.element.on('mouseup',events.up);self.element.on('mousemove',events.move);self.element.on('touchend',events.up);self.element.on('touchmove',events.movetouch)}};events.unbind=function(){if(events.is){events.is=false;self.element.off('mouseup',events.up);self.element.off('mousemove',events.move);self.element.off('touchend',events.up);self.element.off('touchmove',events.movetouch)}};self.event('contextmenu','.area',function(e){events.is&&events.up();var el=$(this);var id=el.closest('.component').attrd('id');config.contextmenu&&self.SEEX(config.contextmenu,e,'component',self.cache[id].instance);e.preventDefault();e.stopPropagation()});self.event('dblclick','.area',function(){var target=$(this).closest('.component');config.dblclick&&self.SEEX(config.dblclick,self.cache[target.attrd('id')].instance)});self.event('mousedown touchstart','.area',function(e){if(events.is){events.up();return}var parent=e.target,target;while(true){var cl=parent.classList;if(parent===self.dom||cl.contains('selectable'))return;if(cl.contains('component')){target=$(parent);break}parent=parent.parentNode}e.preventDefault();drag.id=target.attrd('id');var evt=e.touches?e.touches[0]:e,tmp=self.cache[drag.id];self.op.unselect('connections');if(tmp.actions.select!==false)self.op.select(drag.id);if(tmp.actions.move===false)return;drag.target=target;drag.x=evt.pageX;drag.y=evt.pageY;drag.zoom=self.info.zoom/100;drag.zoomoffset=((100-self.info.zoom)/10)+(self.info.zoom>100?1:-1);drag.is=false;drag.output=target.find('.output');drag.input=target.find('.input');var pos=target.position();drag.posX=pos.left;drag.posY=pos.top;self.focused&&self.focused.rclass('component-focused');self.focused=target.aclass('component-focused');events.bind()})});EXTENSION('flow:connections',function(self,config){var D='__',events={},drag={},prevselected=null;drag.css={};var zoom=function(val){return Math.ceil(val/drag.zoom)-drag.zoomoffset};events.move=function(e){var x=(e.pageX-drag.x)+drag.offsetX;var y=(e.pageY-drag.y)+drag.offsetY;drag.path.attr('d',drag.input?self.helpers.connect(zoom(x),zoom(y),zoom(drag.pos.x),zoom(drag.pos.y),-1,drag.realindex):self.helpers.connect(zoom(drag.pos.x),zoom(drag.pos.y),zoom(x),zoom(y),drag.realindex,-1));if(drag.click)drag.click=false};events.movetouch=function(e){var evt=e.touches[0];drag.lastX=evt.pageX;drag.lastY=evt.pageY;events.move(evt)};events.up=function(e){drag.path.remove();events.unbind();if(drag.click&&(Date.now()-drag.ticks)<150){var icon=drag.target.find('.component-io');var clsp='disabled';icon.tclass(clsp);var key=(drag.input?'input':'output')+D+drag.pos.id+D+drag.pos.index;var model=self.get();if(!model.paused)model.paused={};if(icon.hclass(clsp))model.paused[key]=1;else delete model.paused[key];self.op.modify(model[drag.pos.id],'pause');setTimeout2(self.ID+'clean',self.op.clean,2000);self.op.modified();return}if(drag.lastX!=null&&drag.lastY!=null)e.target=document.elementFromPoint(drag.lastX,drag.lastY);drag.target.add(drag.targetcomponent).rclass('connecting');if(drag.input){var output=$(e.target).closest('.output');if(!output.length)return;if(self.helpers.isconnected(output,drag.target))return;self.el.connect(output,drag.target)}else{var input=$(e.target).closest('.input');if(!input.length)return;if(self.helpers.isconnected(drag.target,input))return;self.el.connect(drag.target,input)}};events.bind=function(){if(!events.is){events.is=true;self.element.on('mouseup',events.up);self.element.on('mousemove',events.move);self.element.on('touchend',events.up);self.element.on('touchmove',events.movetouch)}};events.unbind=function(){if(events.is){events.is=false;self.element.off('mouseup',events.up);self.element.off('mousemove',events.move);self.element.off('touchend',events.up);self.element.off('touchmove',events.movetouch)}};self.event('mousedown touchstart','.output,.input',function(e){if(e.button)return;e.preventDefault();e.stopPropagation();if(config.horizontal&&!e.target.classList.contains('component-io'))return;drag.click=true;drag.ticks=Date.now();var target=$(this);var evt=e.touches?e.touches[0]:e,com=target.closest('.component');var tmp=self.cache[com.attrd('id')];if(tmp.actions.disabled||tmp.actions.connect===false)return;var offset=self.getOffset();var targetoffset=target.offset();drag.input=target.hclass('input');drag.target=target;drag.index=+target.attrd('index');drag.realindex=target.index();drag.x=evt.pageX;drag.y=evt.pageY;drag.zoom=self.info.zoom/100;drag.zoomoffset=((100-self.info.zoom)/10)+(self.info.zoom>100?1:-1);drag.pos=self.helpers.position(target,!drag.input);drag.target.add(com).aclass('connecting');drag.targetcomponent=com;drag.lastX=null;drag.lastY=null;if(drag.input)drag.pos.x-=config.paddingX;if(evt.offsetX==null||evt.offsetY==null){var off=self.op.position();drag.offsetX=drag.x-off.left;drag.offsetY=drag.y-off.top}else{drag.offsetX=(targetoffset.left-offset.left)+evt.offsetX+(drag.input?2:5);drag.offsetY=(targetoffset.top-offset.top)+evt.offsetY+(drag.input?2:2)}if(config.horizontal){if(drag.input)drag.offsetX-=10;else drag.offsetX=drag.offsetX+(com.width()*drag.zoom)-10}drag.path=self.el.lines.asvg('path');drag.path.aclass('connection connection-draft');events.bind()});self.el.connect=function(output,input,init){if(!output[0]||!input[0])return false;drag.zoom=self.info.zoom/100;drag.zoomoffset=((100-self.info.zoom)/10)-1;var a=self.helpers.position(output,true);var b=self.helpers.position(input);b.x-=config.paddingX;if(drag.zoom!==1){b.x=zoom(b.x);b.y=zoom(b.y);a.x=zoom(a.x);a.y=zoom(a.y)}var path=self.el.lines.asvg('path');path.aclass('connection from'+D+a.id+' to'+D+b.id+' from'+D+a.id+D+a.index+' to'+D+b.id+D+b.index+' conn'+D+a.id+D+b.id+D+a.index+D+b.index);path.attrd('offset',a.x+','+a.y+','+b.x+','+b.y);path.attrd('fromindex',a.index);path.attrd('toindex',b.index);path.attrd('fromindexoffset',a.indexoffset);path.attrd('toindexoffset',b.indexoffset);path.attrd('from',a.id);path.attrd('to',b.id);path.attr('d',self.helpers.connect(a.x,a.y,b.x,b.y,a.indexoffset,b.indexoffset));input.add(output).aclass('connected');if(init){var kp='input'+D+b.id+D+b.index;input.find('.component-io').tclass('disabled',!!self.paused[kp]);kp='output'+D+a.id+D+a.index;output.find('.component-io').tclass('disabled',!!self.paused[kp])}var data=self.get();var ac=data[a.id],bc=data[b.id],key=a.index+'';if(ac.connections==null)ac.connections={};if(ac.connections[key]==null)ac.connections[key]=[];self.op.modify(ac,'connect');self.op.modify(bc,'connect');var arr=ac.connections[key],bindex=b.index+'',is=true;for(var i=0;i<arr.length;i++){var tmp=arr[i];if(tmp.id===b.id&&tmp.index===bindex){is=false;break}}if(is)ac.connections[key].push({id:b.id+'',index:bindex});output.closest('.component').aclass('connected');var meta={};meta.output=ac;meta.input=data[b.id];meta.fromid=a.id;meta.toid=b.id;meta.fromindex=a.index;meta.toindex=b.index;meta.path=path;ac.onconnect&&ac.onconnect.call(ac,meta);bc.onconnect&&bc.onconnect.call(bc,meta);config.onconnect&&self.EXEC(config.onconnect,meta);if(!init){self.op.undo({type:'connect',fromid:meta.fromid,toid:meta.toid,fromindex:meta.fromindex+'',toindex:meta.toindex+''});self.op.modified()}return true};self.event('contextmenu','.connection',function(e){events.is&&events.up();var el=$(this);var meta={},classes=el.attr('class').split(' ');for(var i=0;i<classes.length;i++){var cls=classes[i];if(cls.substring(0,6)==='conn__'){var arr=cls.split('__');meta.fromid=arr[1];meta.toid=arr[2];meta.fromindex=arr[3];meta.toindex=arr[4];meta.from=self.cache[meta.fromid].instance;meta.to=self.cache[meta.toid].instance;break}}meta.fromid&&config.contextmenu&&self.SEEX(config.contextmenu,e,'connection',meta);e.preventDefault();e.stopPropagation()});self.event('mousedown touchstart','.connection',function(e){var el=$(this);var cls='connection-selected';self.op.unselect();if(el.hclass(cls))return;prevselected&&prevselected.rclass(cls);el.aclass(cls);prevselected=el;var conn=self.helpers.parseconnection(el);conn.isconnection=true;conn.frominstance=self.cache[conn.fromid].instance;conn.toinstance=self.cache[conn.toid].instance;self.info.selected=conn;self.op.refreshinfo();var dom=el[0],parent=el.parent()[0];parent.removeChild(dom);parent.appendChild(dom);e.preventDefault();e.stopPropagation()})});EXTENSION('flow:commands',function(self,config){var zoom=1,disconnect=function(){var arr=self.el.lines.find('.connection-selected');for(var i=0;i<arr.length;i++){var obj=self.helpers.parseconnection($(arr[i]));obj&&self.op.disconnect(obj.fromid,obj.toid,obj.fromindex,obj.toindex)}};var remove=function(){var arr=self.find('.component-selected');for(var i=0;i<arr.length;i++)self.op.remove($(arr[i]).attrd('id'))};self.command('flow.refresh',self.op.reposition);self.command('flow.components.find',function(id){var com=self.cache[id];if(com){var pos=com.el.offset();var scroll=self.closest('.ui-scrollbar-area');if(scroll){var offset=self.element.offset();scroll.animate({scrollLeft:pos.left-200-offset.left,scrollTop:pos.top-150-offset.top},300);self.op.unselect();self.op.select(id)}}});self.command('flow.selected.disconnect',function(){disconnect();self.op.unselect()});self.command('flow.selected.remove',function(){remove();self.op.unselect()});function translate_path(count,path){var l=path.getTotalLength();var t=(l/100)*count;var p=path.getPointAtLength(t);return'translate('+p.x+','+p.y+')'}self.command('flow.traffic',function(id,opt){if(!opt)opt={speed:3,count:1,delay:50};if(!opt.limit)opt.limit=20;var path=self.el.lines.find('.from__'+id);if(opt.count>opt.limit)opt.count=opt.limit;if(!path.length||(self.animations[id]>opt.limit)||document.hidden)return;var add=function(next){for(var i=0;i<path.length;i++){var el=self.el.anim.asvg('circle').aclass('traffic').attr('r',opt.radius||config.animationradius);var dom=el[0];dom.$path=path[i];dom.$count=0;dom.$token=self.animations_token;if(self.animations[id])self.animations[id]++;else self.animations[id]=1;(function(self,el,dom,opt){var fn=function(){dom.$count+=(opt.speed||3);if(document.hidden||!dom.$path||!dom.$path.parentNode||dom.$token!==self.animations_token){el.remove();if(self.animations[id])self.animations[id]--;return}if(dom.$count>=100){if(self.animations[id]>0)self.animations[id]--;el.remove()}else el.attr('transform',translate_path(dom.$count,dom.$path));requestAnimationFrame(fn)};requestAnimationFrame(fn)})(self,el,dom,opt)}next&&setTimeout(next,opt.delay||50)};if(!opt.count||opt.count===1){add();return}var arr=[];for(var i=0;i<opt.count;i++)arr.push(add);arr.wait(function(fn,next){fn(next)})});self.command('flow.selected.clear',function(){disconnect();remove();self.op.unselect()});self.command('flow.clean',function(){self.op.clean()});self.command('flow.components.add',function(com){if(!com.id)com.id='f'+Date.now().toString(36);var data=self.get();data[com.id]=com;self.op.modify(com,'newbie');self.op.modified();self.refresh(true);self.op.undo({type:'component',id:com.id})});self.command('flow.zoom',function(type){switch(type){case'in':zoom+=0.05;break;case'out':zoom-=0.05;break;case'reset':zoom=1;break}if(zoom<0.3||zoom>1.7)return;self.info.zoom=100*zoom;self.op.refreshinfo();self.element.css('transform','scale({0})'.format(zoom))});self.command('flow.undo',function(){var prev=self.undo.pop();if(prev==null)return;self.op.undo();self.op.redo(prev);if(prev.type==='disconnect'){var output=self.find('.component[data-id="{0}"]'.format(prev.fromid)).find('.output[data-index="{0}"]'.format(prev.fromindex));var input=self.find('.component[data-id="{0}"]'.format(prev.toid)).find('.input[data-index="{0}"]'.format(prev.toindex));self.el.connect(output,input,true);return}if(prev.type==='connect'){self.op.disconnect(prev.fromid,prev.toid,prev.fromindex,prev.toindex,true);return}if(prev.type==='component'){self.op.remove(prev.id,true);return}if(prev.type==='move'){self.find('.component[data-id="{0}"]'.format(prev.id)).css({left:prev.x,top:prev.y});self.op.reposition();return}if(prev.type==='remove'){var com=prev.instance;com.id=prev.id;var data=self.get();data[com.id]=com;self.op.modified();self.update('refresh');return}});self.command('flow.redo',function(){var next=self.redo.pop();if(next==null)return;self.op.redo();self.op.undo(next);self.op.refreshinfo();if(next.type==='disconnect'){self.op.disconnect(next.fromid,next.toid,next.fromindex,next.toindex,true);return}if(next.type==='connect'){var output=self.find('.component[data-id="{0}"]'.format(next.fromid)).find('.output[data-index="{0}"]'.format(next.fromindex));var input=self.find('.component[data-id="{0}"]'.format(next.toid)).find('.input[data-index="{0}"]'.format(next.toindex));self.el.connect(output,input,true);return}if(next.type==='component'){var com=next.instance;com.id=next.id;var data=self.get();data[com.id]=com;self.op.modified();self.refresh(true);return}if(next.type==='move'){self.find('.component[data-id="{0}"]'.format(next.id)).css({left:next.newx,top:next.newy});self.op.reposition();return}if(next.type==='remove'){self.op.remove(next.id,true);return}});self.command('flow.reset',function(){self.refresh();self.info.selected=null;self.op.refreshinfo();self.undo=[];self.redo=[];self.op.undo();self.op.redo()})});
// End: j-Flow

// Component: j-SearchInput
// Version: 1
// Updated: 2021-04-20 16:00
COMPONENT('searchinput','searchicon:fa fa-search;cancelicon:fa fa-times;align:left',function(self,config,cls){var input,icon,prev,prev2;self.novalidate();self.make=function(){self.aclass(cls+' '+cls+'-'+config.align);self.html('<span><i class="{0}"></i></span><div><input type="text" autocomplete="new-password" maxlength="100" placeholder="{1}" data-jc-bind /></div>'.format(config.searchicon,config.placeholder));input=self.find('input')[0];icon=self.find('i');self.event('click','span',function(){prev&&self.set('');prev2=''});if(config.autofocus&&!isMOBILE){setTimeout(function(){input.focus()},config.autofocus==true?500:config.autofocus)}};self.focus=function(){input&&input.focus()};self.check=function(){var is=!!input.value.trim();if(is!==prev){icon.rclass().aclass(is?config.cancelicon:config.searchicon);prev=is;self.tclass(cls+'-is',is)}};self.clear=function(){input.value='';config.exec&&self.SEEX(config.exec,input.value,self.element);self.check()};self.setter=function(value,path,type){input.value=value||'';if(prev2!==input.value){prev2=input.value;type&&config.exec&&self.SEEX(config.exec,input.value,self.element)}self.check()}});
// End: j-SearchInput

// Component: j-ViewBox
// Version: 1
// Updated: 2021-03-01 13:37
COMPONENT('viewbox','margin:0;scroll:true;delay:100;scrollbar:0;visibleY:1;height:100;invisible:1',function(self,config,cls){var eld,elb,scrollbar,cls2='.'+cls,init=false,cache,scrolltoforce;self.readonly();self.init=function(){var resize=function(){for(var i=0;i<M.components.length;i++){var com=M.components[i];if(com.name==='viewbox'&&com.dom.offsetParent&&com.$ready&&!com.$removed)com.resizeforce()}};ON('resize2',function(){setTimeout2('viewboxresize',resize,200)})};self.destroy=function(){scrollbar&&scrollbar.destroy()};self.configure=function(key,value,init){switch(key){case'disabled':eld.tclass('hidden',!value);break;case'minheight':case'margin':case'marginxs':case'marginsm':case'marginmd':case'marginlg':!init&&self.resize();break;case'selector':config.parent=value;self.resize();break}};self.scrollbottom=function(val){if(val==null)return elb[0].scrollTop;elb[0].scrollTop=(elb[0].scrollHeight-self.dom.clientHeight)-(val||0);return elb[0].scrollTop};self.scrolltop=function(val){if(val==null)return elb[0].scrollTop;elb[0].scrollTop=(val||0);return elb[0].scrollTop};self.make=function(){config.invisible&&self.aclass('invisible');config.scroll&&MAIN.version>17&&self.element.wrapInner('<div class="'+cls+'-body"></div>');self.element.prepend('<div class="'+cls+'-disabled hidden"></div>');eld=self.find('> .{0}-disabled'.format(cls)).eq(0);elb=self.find('> .{0}-body'.format(cls)).eq(0);self.aclass('{0} {0}-hidden'.format(cls));if(config.scroll){if(config.scrollbar){if(MAIN.version>17){scrollbar=W.SCROLLBAR(self.find(cls2+'-body'),{shadow:config.scrollbarshadow,visibleY:config.visibleY,visibleX:config.visibleX,orientation:config.visibleX?null:'y',parent:self.element});self.scrolltop=scrollbar.scrollTop;self.scrollbottom=scrollbar.scrollBottom}else self.aclass(cls+'-scroll')}else{self.aclass(cls+'-scroll');self.find(cls2+'-body').aclass('noscrollbar')}}self.resize()};self.released=function(is){!is&&self.resize()};var css={};self.resize=function(){setTimeout2(self.ID,self.resizeforce,200)};self.resizeforce=function(){var el=self.parent(config.parent);var h=el.height();var w=el.width();var width=WIDTH();var mywidth=self.element.width();var key=width+'x'+mywidth+'x'+w+'x'+h;if(cache===key){scrollbar&&scrollbar.resize();if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}return}cache=key;var margin=config.margin,responsivemargin=config['margin'+width];if(responsivemargin!=null)margin=responsivemargin;if(margin==='auto')margin=self.element.offset().top;if(h===0||w===0){self.$waiting&&clearTimeout(self.$waiting);self.$waiting=setTimeout(self.resize,234);return}h=((h/100)*config.height)-margin;if(config.minheight&&h<config.minheight)h=config.minheight;css.height=h;css.width=mywidth;eld.css(css);css.width='';self.css(css);elb.length&&elb.css(css);self.element.SETTER('*','resize');var c=cls+'-hidden';self.hclass(c)&&self.rclass(c,100);scrollbar&&scrollbar.resize();if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}if(!init){self.rclass('invisible',250);init=true}};self.resizescrollbar=function(){scrollbar&&scrollbar.resize()};self.setter=function(){scrolltoforce=config.scrollto||config.scrolltop;if(scrolltoforce){if(scrolltoforce==='bottom')self.scrollbottom(0);else self.scrolltop(0);scrolltoforce=null}setTimeout(self.resize,config.delay,scrolltoforce)}});
// End: j-ViewBox

// Component: j-VirtualWire
// Version: 1
// Updated: 2020-02-07 11:48
COMPONENT('virtualwire','selector:.virtualwire',function(self,config){var old,waiter;self.restore=function(){if(old){while(self.dom.children.length)old[0].appendChild(self.dom.children[0]);var exec=old.attrd('out');exec&&EXEC(exec);old=null}};self.backup=function(el){if(!el||!el.length){self.restore();return}if(old&&old[0]===el[0])return;self.restore();var children=el[0].children;while(children.length)self.dom.appendChild(children[0]);old=el;var exec=el.attrd('in');exec&&EXEC(exec)};self.load=function(value){waiter&&clearTimeout(waiter);waiter=null;var el=$(config.selector+'[data-if="'+value+'"]');if(el.length)self.backup(el);else waiter=setTimeout(self.load,100,value)};self.setter=function(value){self.restore();if(!value)return;waiter&&clearTimeout(waiter);self.load(value)}});
// End: j-VirtualWire

// Component: j-WebSocket
// Version: 1
// Updated: 2020-11-13 00:37
COMPONENT('websocket','reconnect:3000;encoder:false',function(self,config){var ws,url,queue=[],sending=false,isidle=false;self.online=false;self.readonly();self.nocompile&&self.nocompile();self.make=function(){url=(config.url||'').env(true);if(!url.match(/^(ws|wss):\/\//))url=location.origin.replace('http','ws')+(url.charAt(0)!=='/'?'/':'')+url;setTimeout(self.connect,500);self.destroy=function(){isidle=true;self.close()}};self.send=function(obj){var data=JSON.stringify(obj);if(config.encoder)queue.push(encodeURIComponent(data));else queue.push(data);self.process();return self};self.idletime=function(is){if(isidle!==is){isidle=is;if(is){ws&&self.close()}else{if(!ws)self.connect()}}};self.process=function(callback){if(!ws||!ws.send||sending||!queue.length||ws.readyState!==1){callback&&callback();return}sending=true;var async=queue.splice(0,3);async.wait(function(item,next){if(ws){ws.send(item);setTimeout(next,5)}else{queue.unshift(item);next()}},function(){callback&&callback();sending=false;queue.length&&self.process()})};self.close=function(isClosed){if(ws){self.online=false;ws.onopen=ws.onclose=ws.onmessage=null;!isClosed&&ws.close();ws=null;EMIT('online',false)}return self};function onClose(e){if(e.code===4001){location.href=location.href+'';return}e.reason&&WARN('WebSocket:',config.encoder?decodeURIComponent(e.reason):e.reason);self.close(true);if(!isidle)setTimeout(self.connect,config.reconnect)}function onMessage(e){var data;try{data=PARSE(config.encoder?decodeURIComponent(e.data):e.data);self.path&&self.set(data)}catch(e){WARN('WebSocket "{0}": {1}'.format(url,e.toString()))}data&&EMIT('message',data)}function onOpen(){self.online=true;self.process(function(){EMIT('online',true)})}self.connect=function(){ws&&self.close();setTimeout2(self.id,function(){ws=new WebSocket(url.env(true));ws.onopen=onOpen;ws.onclose=onClose;ws.onmessage=onMessage;self.ws=ws},100);return self}});
// End: j-WebSocket

// Component: j-Loading
// Version: 1
// Updated: 2021-02-11 09:46
COMPONENT('loading',function(self,config,cls){var delay,prev;self.readonly();self.singleton();self.nocompile();self.make=function(){self.aclass(cls+' '+cls+'-'+(config.style||1));self.append('<div><div class="'+cls+'-text hellip"></div></div>')};self.show=function(text){clearTimeout(delay);if(prev!==text){prev=text;self.find('.'+cls+'-text').html(text||'')}self.rclass('hidden');document.activeElement&&document.activeElement.blur();return self};self.hide=function(timeout){clearTimeout(delay);delay=setTimeout(function(){self.aclass('hidden')},timeout||1);return self}});
// End: j-Loading

// Component: j-Part
// Version: 1
// Updated: 2021-03-28 19:30
COMPONENT('part','hide:1;loading:1',function(self,config,cls){var init=false,clid=null,downloading=false,isresizing=false;self.releasemode&&self.releasemode('true');self.readonly();self.make=function(){self.aclass(cls)};self.resize=function(){if(config.absolute){var pos=self.element.position();var obj={};obj.width=WW-pos.left;obj.height=WH-pos.top;self.css(obj)}};var replace=function(value){return self.scope?self.makepath(value):value.replace(/\?/g,config.if)};self.setter=function(value){if(config.if!==value){if(!self.hclass('hidden')){config.hidden&&EXEC(replace(config.hidden));config.hide&&self.aclass('hidden');self.release(true)}if(config.cleaner&&init&&!clid)clid=setTimeout(self.clean,config.cleaner*60000);return}if(config.absolute&&!isresizing){self.on('resize2',self.resize);isresizing=true}if(self.dom.hasChildNodes()){if(clid){clearTimeout(clid);clid=null}self.release(false);var done=function(){config.hide&&self.rclass('hidden');config.reload&&EXEC(replace(config.reload));config.default&&DEFAULT(replace(config.default),true);self.hclass('invisible')&&self.rclass('invisible',500);isresizing&&setTimeout(self.resize,50);setTimeout(self.emitresize,200)};if(config.check)EXEC(replace(config.check),done);else done()}else{if(downloading)return;config.loading&&SETTER('loading','show');downloading=true;setTimeout(function(){var preparator;if(config.replace)preparator=GET(replace(config.replace));else{preparator=function(content){return content.replace(/~PATH~/g,replace(config.path||config.if))}}self.import(replace(config.url),function(){downloading=false;if(!init){config.init&&EXEC(replace(config.init));init=true}var done=function(){config.hide&&self.rclass('hidden');self.release(false);config.reload&&EXEC(replace(config.reload),true);config.default&&DEFAULT(replace(config.default),true);config.loading&&SETTER('loading','hide',500);self.hclass('invisible')&&self.rclass('invisible',500);isresizing&&setTimeout(self.resize,50);setTimeout(self.emitresize,200)};EMIT('parts.'+config.if,self.element,self);if(config.check)EXEC(replace(config.check),done);else done()},true,preparator)},200)}};self.emitresize=function(){self.element.SETTER('*','resize')};self.configure=function(key,value){switch(key){case'if':config.if=value+'';break;case'absolute':var is=!!value;self.tclass(cls+'-absolute',is);break}};self.clean=function(){if(self.hclass('hidden')){config.clean&&EXEC(replace(config.clean));setTimeout(function(){self.empty();init=false;clid=null;setTimeout(FREE,1000)},1000)}}});
// End: j-Part

// Component: j-LargeForm
// Version: 1
// Updated: 2021-04-08 10:53
COMPONENT('largeform','zindex:12;padding:30;scrollbar:1;scrolltop:1;style:1',function(self,config,cls){var cls2='.'+cls,csspos={},nav=false,init=false;if(!W.$$largeform){W.$$largeform_level=W.$$largeform_level||1;W.$$largeform=true;$(document).on('click',cls2+'-button-close',function(){SET($(this).attrd('path'),'')});var resize=function(){setTimeout2(self.name,function(){for(var i=0;i<M.components.length;i++){var com=M.components[i];if(com.name==='largeform'&&!HIDDEN(com.dom)&&com.$ready&&!com.$removed)com.resize()}},200)};ON('resize2',resize);$(document).on('click',cls2+'-container',function(e){if(e.target===this){var com=$(this).component();if(com&&com.config.closeoutside){com.set('');return}}var el=$(e.target);if(el.hclass(cls+'-container')&&!el.hclass(cls+'-style-2')){var form=el.find(cls2);var c=cls+'-animate-click';form.aclass(c);setTimeout(function(){form.rclass(c)},300)}})}self.readonly();self.submit=function(){if(config.submit)self.EXEC(config.submit,self.hide,self.element);else self.hide()};self.cancel=function(){config.cancel&&self.EXEC(config.cancel,self.hide);self.hide()};self.hide=function(){if(config.independent)self.hideforce();self.esc(false);self.set('')};self.icon=function(value){var el=this.rclass2('fa');value.icon&&el.aclass(value.icon.indexOf(' ')===-1?('fa fa-'+value.icon):value.icon)};self.resize=function(){if(self.hclass('hidden'))return;var padding=isMOBILE?0:config.padding,ui=self.find(cls2);csspos.height=WH-(config.style==1?(padding*2):padding);csspos.top=padding;ui.css(csspos);var el=self.find(cls2+'-title');var th=el.height();var w=ui.width();if(w>WW)w=WW;csspos={height:csspos.height-th,width:w};if(nav)csspos.height-=nav.height();self.find(cls2+'-body').css(csspos);self.scrollbar&&self.scrollbar.resize();self.element.SETTER('*','resize')};self.make=function(){$(document.body).append('<div id="{0}" class="hidden {4}-container invisible"><div class="{4}" style="max-width:{1}px"><div data-bind="@config__text span:value.title__change .{4}-icon:@icon" class="{4}-title"><button name="cancel" class="{4}-button-close{3}" data-path="{2}"><i class="fa fa-times"></i></button><i class="{4}-icon"></i><span></span></div><div class="{4}-body"></div></div>'.format(self.ID,config.width||800,self.path,config.closebutton==false?' hidden':'',cls));var scr=self.find('> script');self.template=scr.length?scr.html().trim():'';scr.length&&scr.remove();var el=$('#'+self.ID);var body=el.find(cls2+'-body')[0];while(self.dom.children.length){var child=self.dom.children[0];if(child.tagName==='NAV'){nav=$(child);body.parentNode.appendChild(child)}else body.appendChild(child)}self.rclass('hidden invisible');self.replace(el,true);if(config.scrollbar)self.scrollbar=SCROLLBAR(self.find(cls2+'-body'),{shadow:config.scrollbarshadow,visibleY:config.visibleY,orientation:'y'});if(config.style===2)self.aclass(cls+'-style-2');self.event('scroll',function(){EMIT('scroll',self.name);EMIT('reflow',self.name)});self.event('click','button[name]',function(){var t=this;switch(t.name){case'submit':self.submit(self.hide);break;case'cancel':!t.disabled&&self[t.name](self.hide);break}});config.enter&&self.event('keydown','input',function(e){e.which===13&&!self.find('button[name="submit"]')[0].disabled&&setTimeout(self.submit,800)})};self.configure=function(key,value,init,prev){if(!init){switch(key){case'width':value!==prev&&self.find(cls2).css('max-width',value+'px');break;case'closebutton':self.find(cls2+'-button-close').tclass('hidden',value!==true);break}}};self.esc=function(bind){if(bind){if(!self.$esc){self.$esc=true;$(W).on('keydown',self.esc_keydown)}}else{if(self.$esc){self.$esc=false;$(W).off('keydown',self.esc_keydown)}}};self.esc_keydown=function(e){if(e.which===27&&!e.isPropagationStopped()){var val=self.get();if(!val||config.if===val){e.preventDefault();e.stopPropagation();self.hide()}}};self.hideforce=function(){if(!self.hclass('hidden')){self.aclass('hidden');self.release(true);self.find(cls2).rclass(cls+'-animate');W.$$largeform_level--}};var allowscrollbars=function(){$('html').tclass(cls+'-noscroll',!!$(cls2+'-container').not('.hidden').length)};self.setter=function(value){setTimeout2(self.name+'-noscroll',allowscrollbars,50);var isHidden=value!==config.if;if(self.hclass('hidden')===isHidden){if(!isHidden){config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);config.scrolltop&&self.scrollbar&&self.scrollbar.scrollTop(0)}return}setTimeout2(cls,function(){EMIT('reflow',self.name)},10);if(isHidden){if(!config.independent)self.hideforce();return}if(self.template){var is=self.template.COMPILABLE();self.find(cls2).append(self.template);self.template=null;is&&COMPILE()}if(W.$$largeform_level<1)W.$$largeform_level=1;W.$$largeform_level++;self.css('z-index',W.$$largeform_level*config.zindex);self.aclass('invisible');self.rclass('hidden');self.release(false);config.scrolltop&&self.scrollbar&&self.scrollbar.scrollTop(0);config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);if(!isMOBILE&&config.autofocus){setTimeout(function(){self.find(typeof(config.autofocus)==='string'?config.autofocus:'input[type="text"],select,textarea').eq(0).focus()},1000)}self.resize();setTimeout(function(){self.rclass('invisible');self.find(cls2).aclass(cls+'-animate');if(!init&&isMOBILE){$('body').aclass('hidden');setTimeout(function(){$('body').rclass('hidden')},50)}init=true},200);setTimeout2(self.ID,function(){self.css('z-index',(W.$$largeform_level*config.zindex)+1)},500);config.closeesc&&self.esc(true)}});
// End: j-LargeForm

// Component: j-Validation
// Version: 1
// Updated: 2021-03-16 21:25
COMPONENT('validation','delay:100;flags:visible',function(self,config,cls){var elements=null,def='button[name="submit"]',flags=null,tracked=false,reset=0,old,track;self.readonly();self.make=function(){elements=self.find(config.selector||def)};self.configure=function(key,value,init){switch(key){case'selector':if(!init)elements=self.find(value||def);break;case'flags':if(value){flags=value.split(',');for(var i=0;i<flags.length;i++)flags[i]='@'+flags[i]}else flags=null;break;case'track':track=value.split(',').trim();break}};var settracked=function(){tracked=0};self.setter=function(value,path,type){var is=path===self.path||path.length<self.path.length;if(reset!==is){reset=is;self.tclass(cls+'-modified',!reset)}if((type===1||type===2)&&track&&track.length){for(var i=0;i<track.length;i++){if(path.indexOf(track[i])!==-1){tracked=1;return}}if(tracked===1){tracked=2;setTimeout(settracked,config.delay*3)}}};var check=function(){var path=self.path.replace(/\.\*$/,'');var disabled=tracked||config.validonly?!VALID(path,flags):DISABLED(path,flags);if(!disabled&&config.if)disabled=!EVALUATE(path,config.if);if(disabled!==old){elements.prop('disabled',disabled);self.tclass(cls+'-ok',!disabled);self.tclass(cls+'-no',disabled);old=disabled}};self.state=function(type,what){if(type===3||what===3){self.rclass(cls+'-modified');tracked=0}setTimeout2(self.ID,check,config.delay)}});
// End: j-Validation

// Component: j-Search
// Version: 1
// Updated: 2020-11-12 13:04
COMPONENT('search','class:hidden;delay:50;attribute:data-search;splitwords:1;delaydatasource:100',function(self,config,cls){self.readonly();self.make=function(){config.datasource&&self.datasource(config.datasource,function(){setTimeout(function(){self.refresh()},config.delaydatasource)})};self.search=function(){var value=self.get();var elements=self.find(config.selector);var length=elements.length;if(!value){elements.rclass(config.class);self.rclass2(cls+'-');config.exec&&self.SEEX(config.exec,{hidden:0,count:length,total:length,search:'',is:false});return}var search=value.toSearch();var count=0,hidden=0;if(config.splitwords)search=search.split(' ');self.aclass(cls+'-used');for(var i=0;i<length;i++){var el=elements.eq(i);var val=(el.attr(config.attribute)||'').toSearch();var is=false;if(search instanceof Array){for(var j=0;j<search.length;j++){if(val.indexOf(search[j])===-1){is=true;break}}}else is=val.indexOf(search)===-1;el.tclass(config.class,is);if(is)hidden++;else count++}self.tclass(cls+'-empty',!count);config.exec&&self.SEEX(config.exec,{total:length,hidden:hidden,count:count,search:search,is:true})};self.setter=function(value){if(!config.selector||!config.attribute||value==null)return;setTimeout2('search'+self.ID,self.search,config.delay)}});
// End: j-Search

// Component: j-Selected
// Version: 1
// Updated: 2020-09-08 09:41
COMPONENT('selected','class:selected;selector:a;attr:if',function(self,config){self.readonly();self.configure=function(key,value){switch(key){case'datasource':self.datasource(value,function(){setTimeout(self.refresh,50)});break}};self.setter=function(value){var cls=config.class;self.find(config.selector).each(function(){var el=$(this);if(el.attrd(config.attr)===value)el.aclass(cls);else el.hclass(cls)&&el.rclass(cls)})}});
// End: j-Selected

// Component: j-Animation
// Version: 1
// Updated: 2020-12-29 21:08
COMPONENT('animation','style:2;delay:200;init:1000;cleaner:1000;visible:0;offset:50',function(self,config,cls){self.readonly();if(!config.if)self.blind();self.destroy=function(){self.visibleinterval&&clearInterval(self.interval)};self.make=function(){if(config.visible){self.visibleinterval=setInterval(function(){if(VISIBLE(self.dom,config.offset)){self.visibleinterval=null;clearInterval(self.visibleinterval);self.animate()}},500)}else setTimeout2(self.ID,self.animate,config.init);config.datasource&&self.datasource(config.datasource,function(){setTimeout2(self.ID,self.animate,config.init)})};self.restore=function(){self.find('.animated').aclass('animation').rclass('animated')};self.animate=function(){var el=self.find('.animation');var arr=[];for(var i=0;i<el.length;i++){var t=el[i];if(!t.$anim){var $t=$(t);if(!t.$animopt){var opt=($t.attrd('animation')||'').parseConfig();t.$animopt=opt}t.$anim=cls+'-'+(t.$animopt.style||config.style);$t.aclass(t.$anim+'-init animating');arr.push($t)}}if(!arr.length)return;setTimeout(function(arr){if(self.removed)return;var maxdelay=500;if(config.together){for(var i=0;i<arr.length;i++){var el=arr[i],c=el[0].$anim,opt=el[0].$animopt;if(!self.removed){if(opt.noanimation)el.rclass('animation '+c+'-init');else el.rclass('animation').aclass(c+'-run')}}setTimeout(function(){if(!self.removed){for(var i=0;i<arr.length;i++){var c=arr[i][0].$anim;arr[i].rclass(c+'-init '+c+'-run animating').aclass('animated');delete arr[i][0].$anim}config.exec&&self.EXEC(config.exec,self.element)}},1500);return}arr.wait(function(el,next,index){var opt=el[0].$animopt,delay=(opt.order||index)*(opt.delay||config.delay);var clsname=cls+'-'+(opt.style||config.style);if(maxdelay<delay)maxdelay=delay;if(el.hclass('hidden')||el.hclass('invisible')){el.rclass('animation '+clsname+'-init').aclass('animated');next();return}el[0].$animtime=setTimeout(function(el){if(!self.removed){if(opt.noanimation)el.rclass('animation '+clsname+'-init');else el.rclass('animation').aclass(clsname+'-run')}},delay,el);next()},function(){setTimeout(function(){for(var i=0;i<arr.length;i++){var c=arr[i][0].$anim;arr[i].rclass(c+'-init '+c+'-run animating').aclass('animated');delete arr[i][0].$anim}config.exec&&self.EXEC(config.exec,self.element)},maxdelay+1000)})},config.init/10>>0,arr)};self.setter=function(value){if(config.if){if(value===config.if)setTimeout2(self.ID,self.animate,config.init);else self.restore()}}});
// End: j-Animation

// Component: j-Layout
// Version: 1
// Updated: 2020-10-25 13:02
COMPONENT('layout','space:1;border:0;parent:window;margin:0;remember:1;autoresize:1',function(self,config,cls){var cls2='.'+cls,cache={},drag={},s={},events={},istop2=false,isbottom2=false,isright2=false,loaded=false,resizecache='',settings,prefkey='',prefexpire='1 month',isreset=false,layout=null;self.readonly();self.init=function(){ON('resize2 + resize',function(){for(var i=0;i<M.components.length;i++){var com=M.components[i];if(com.name==='layout'&&com.dom.offsetParent&&com.$ready&&!com.$removed&&com.config.autoresize)com.resize()}})};self.make=function(){self.aclass(cls);self.find('> section').each(function(){var el=$(this);var type=el.attrd('type');if(type.charAt(type.length-1)==='2'){type=type.substring(0,type.length-1);switch(type){case'top':istop2=true;break;case'bottom':isbottom2=true;break;case'right':isright2=true;break}}el.aclass(cls+'-'+type+' hidden ui-layout-section');el.after('<div class="{0}-resize-{1} {0}-resize" data-type="{1}"></div>'.format(cls,type));el.after('<div class="{0}-lock hidden" data-type="{1}"></div>'.format(cls,type));s[type]=el});self.find('> .{0}-resize'.format(cls)).each(function(){var el=$(this);s[el.attrd('type')+'resize']=el});self.find('> .{0}-lock'.format(cls)).each(function(){var el=$(this);s[el.attrd('type')+'lock']=el});var tmp=self.find('> script');if(tmp.length){self.rebind(tmp.html(),true);tmp.remove()}events.bind=function(){var el=self.element;el.bind('mousemove',events.mmove);el.bind('mouseup',events.mup);el.bind('mouseleave',events.mup)};events.unbind=function(){var el=self.element;el.unbind('mousemove',events.mmove);el.unbind('mouseup',events.mup);el.unbind('mouseleave',events.mup)};events.mdown=function(e){var target=$(e.target);var type=target.attrd('type');var w=self.width();var h=self.height();var m=2;self.element.find('iframe').css('pointer-events','none');drag.cur=self.element.offset();drag.cur.top-=10;drag.cur.left-=8;drag.offset=target.offset();drag.el=target;drag.x=e.pageX;drag.y=e.pageY;drag.horizontal=type==='left'||type==='right'?1:0;drag.type=type;drag.plusX=10;drag.plusY=10;var ch=cache[type],offset=0,min=ch.minsize?(ch.minsize.value-1):0;target.aclass(cls+'-drag');switch(type){case'top':drag.min=min||(ch.size-m);drag.max=(h-(cache.bottom?s.bottom.height():0)-50);break;case'right':offset=w;drag.min=(cache.left?s.left.width():0)+50+min;drag.max=offset-(min||ch.size);break;case'bottom':offset=h;drag.min=(cache.top?s.top.height():0)+50;drag.max=offset-(min||ch.size);break;case'left':drag.min=min||(ch.size-m);drag.max=w-(cache.right?s.right.width():0)-50;break}events.bind()};events.mmove=function(e){if(drag.horizontal){var x=drag.offset.left+(e.pageX-drag.x)-drag.plusX-drag.cur.left;if(x<drag.min)x=drag.min+1;if(x>drag.max)x=drag.max-1;drag.el.css('left',x+'px')}else{var y=drag.offset.top+(e.pageY-drag.y)-drag.plusY;if(y<drag.min)y=drag.min+1;if(y>drag.max)y=drag.max-1;drag.el.css('top',(y-drag.cur.top)+'px')}};events.mup=function(){self.element.find('iframe').css('pointer-events','');var offset=drag.el.offset();var d=WIDTH();var pk=prefkey+'_'+layout+'_'+drag.type+'_'+d;drag.el.rclass(cls+'-drag');if(drag.horizontal){offset.left-=drag.cur.left;if(offset.left<drag.min)offset.left=drag.min;if(offset.left>drag.max)offset.left=drag.max;var w=offset.left-(drag.offset.left-drag.cur.left);if(!isright2&&drag.type==='right')w=w*-1;drag.el.css('left',offset.left);w=s[drag.type].width()+w;s[drag.type].css('width',w);config.remember&&PREF.set(pk,w,prefexpire)}else{offset.top-=drag.cur.top;if(offset.top<drag.min)offset.top=drag.min;if(offset.top>drag.max)offset.top=drag.max;drag.el.css('top',offset.top);var h=offset.top-(drag.offset.top-drag.cur.top);if(drag.type==='bottom'||drag.type==='preview')h=h*-1;h=s[drag.type].height()+h;s[drag.type].css('height',h);config.remember&&PREF.set(pk,h,prefexpire)}events.unbind();self.refresh()};self.find('> '+cls2+'-resize').on('mousedown',events.mdown)};self.lock=function(type,b){var el=s[type+'lock'];el&&el.tclass('hidden',b==null?b:!b)};self.rebind=function(code,noresize){code=code.trim();prefkey='L'+HASH(code);resizecache='';settings=new Function('return '+code)();!noresize&&self.resize()};var getSize=function(display,data){var obj=data[display];if(obj)return obj;switch(display){case'md':return getSize('lg',data);case'sm':return getSize('md',data);case'xs':return getSize('sm',data)}return data};self.resize=function(){if(self.dom.offsetParent==null){setTimeout(self.resize,100);return}if(settings==null)return;var d=WIDTH();var el=self.parent(config.parent);var width=el.width();var height=el.height();var key=d+'x'+width+'x'+height;if(resizecache===key)return;var tmp=layout?settings[layout]:settings;if(tmp==null){WARN('j-Layout: layout "{0}" not found'.format(layout));tmp=settings}var size=getSize(d,tmp);var keys=Object.keys(s);height-=config.margin;resizecache=key;self.css({width:width,height:height});for(var i=0;i<keys.length;i++){var key=keys[i];el=s[key];self.update(key,size[key]?size[key]:settings[key])}config.resize&&EXEC(config.resize,d,width,height)};var parseSize=function(val,size){var str=typeof(val)==='string';var obj={raw:str?val.parseFloat():val,percentage:str?val.charAt(val.length-1)==='%':false};obj.value=obj.percentage?((((size/100)*obj.raw)>>0)-config.space):obj.raw;return obj};self.reset=function(){isreset=true;resizecache='';self.resize()};self.layout=function(name){if(name==null)name='';if(layout!=name){layout=name;resizecache='';self.resize()}};self.update=function(type,opt){if(opt==null)return;if(typeof(opt)==='string')opt=opt.parseConfig();if(s[type]==null)return;var el=s[type],css={},is=0,size=null,d=WIDTH();var c=cache[type];if(c==null)c=cache[type]={};var w=self.width();var h=self.height();var pk=prefkey+'_'+layout+'_'+type+'_'+d,cached=PREF.get(pk,prefexpire);if(isreset){cached&&PREF.set(pk);cached=0}c.minsize=opt.minwidth?parseSize(opt.minwidth,w):opt.minsize?parseSize(opt.minsize,w):0;var def=getSize(d,settings);var width=(opt.size||opt.width)||(def[type]?def[type].width:0);var height=(opt.size||opt.height)||(def[type]?def[type].height:0);if(width&&(type==='left'||type==='right')){size=parseSize(width,w);c.size=size.value;css.width=cached?cached:size.value;is=1}c.minsize=opt.minheight?parseSize(opt.minheight,w):opt.minsize?parseSize(opt.minsize,w):0;if(height&&(type==='top'||type==='bottom')){size=parseSize(height,h);c.size=size.value;css.height=(cached?cached:size.value);is=1}if(opt.show==null)opt.show=true;el.tclass('hidden',!opt.show);c.show=!!opt.show;c.resize=opt.resize==null?false:!!opt.resize;el.tclass(cls+'-resizable',c.resize);s[type+'resize'].tclass('hidden',!c.show||!c.resize);is&&el.css(css);setTimeout2(self.ID+'refresh',self.refresh,50)};var getWidth=function(el){return el.hclass('hidden')?0:el.width()};var getHeight=function(el){return el.hclass('hidden')?0:el.height()};self.refresh=function(){var top=0,bottom=0,right=0,left=0,hidden='hidden',top2=0,bottom2=0,space=2,topbottomoffset=0,right2visible=isright2&&!s.right.hclass(hidden);if(s.top)top=top2=getHeight(s.top);if(s.bottom)bottom=bottom2=getHeight(s.bottom);var width=self.width()-(config.border*2);var height=self.height()-(config.border*2);if(istop2){topbottomoffset++;top2=0}if(isbottom2){topbottomoffset--;bottom2=0}if(s.left&&!s.left.hclass(hidden)){var cssleft={};space=top&&bottom?2:top||bottom?1:0;cssleft.left=0;cssleft.top=istop2?config.border:(top?(top+config.space):0);cssleft.height=isbottom2?(height-top2-config.border):(height-top2-bottom2-(config.space*space));cssleft.height+=topbottomoffset;s.left.css(cssleft);cssleft.width=s.left.width();s.leftlock.css(cssleft);delete cssleft.width;left=s.left.width();cssleft.left=s.left.width();s.leftresize.css(cssleft);s.leftresize.tclass(hidden,!s.left.hclass(cls+'-resizable'))}if(s.right&&!s.right.hclass(hidden)){right=s.right.width();space=top&&bottom?2:top||bottom?1:0;var cssright={};cssright.left=right2visible?(getWidth(s.left)+config.border+config.space):(width-right);cssright.top=istop2?config.border:(top?(top+config.space):0);cssright.height=isbottom2?(height-top2-config.border):(height-top2-bottom2-(config.space*space));cssright.height+=topbottomoffset;s.right.css(cssright);cssright.width=s.right.width();if(!isright2&&(cssright.left-cssright.width)<=0){s.right.css('left',0);cssright.width++}s.rightlock.css(cssright);delete cssright.width;if(right2visible)cssright.left+=s.right.width();else cssright.left=width-right-2;s.rightresize.css(cssright);s.rightresize.tclass(hidden,!s.right.hclass(cls+'-resizable'))}if(s.top){var csstop={};space=left?config.space:0;csstop.left=istop2?(left+space):0;if(right2visible&&istop2)csstop.left+=getWidth(s.right)+config.space;space=left&&right?2:left||right?1:0;csstop.width=istop2?(width-right-left-(config.space*space)):width;csstop.top=0;s.top.css(csstop);s.topresize.css(csstop);csstop.height=s.top.height();s.toplock.css(csstop);delete csstop.height;csstop.top=s.top.height();s.topresize.css(csstop);s.topresize.tclass(hidden,!s.top.hclass(cls+'-resizable'))}if(s.bottom){var cssbottom={};cssbottom.top=height-bottom;space=left?config.space:0;cssbottom.left=isbottom2?(left+space):0;if(right2visible&&isbottom2)cssbottom.left+=getWidth(s.right)+config.space;space=left&&right?2:left||right?1:0;cssbottom.width=isbottom2?(width-right-left-(config.space*space)):width;s.bottom.css(cssbottom);cssbottom.height=s.bottom.height();s.bottomlock.css(cssbottom);delete cssbottom.height;cssbottom.top=cssbottom.top-2;s.bottomresize.css(cssbottom);s.bottomresize.tclass(hidden,!s.bottom.hclass(cls+'-resizable'))}var space=left&&right?2:left?1:right?1:0,css={};css.left=left?left+config.space:0;if(right2visible)css.left+=getWidth(s.right)+config.space;css.width=(width-left-right-(config.space*space));css.top=top?top+config.space:0;space=top&&bottom?2:top||bottom?1:0;css.height=height-top-bottom-(config.space*space);s.main&&s.main.css(css);s.mainlock&&s.mainlock.css(css);self.element.SETTER('*','resize');if(loaded==false){loaded=true;self.rclass('invisible')}isreset=false};self.setter=function(value){self.layout(value)}});
// End: j-Layout

// Component: j-Markdown
// Version: 1
// Updated: 2021-05-10 12:15
COMPONENT('markdown',function(self){self.readonly();self.singleton();self.blind();self.nocompile();self.make=function(){setTimeout(function(){self.remove()},500);$(document).on('click','.markdown-showsecret,.markdown-showblock',function(){var el=$(this);var next=el.next();next.tclass('hidden');var is=next.hclass('hidden');var icons=el.find('i');if(el.hclass('markdown-showsecret')){icons.eq(0).tclass('fa-unlock',!is).tclass('fa-lock',is);icons.eq(1).tclass('fa-angle-up',!is).tclass('fa-angle-down',is)}else{icons.eq(0).tclass('fa-minus',!is).tclass('fa-plus',is);el.tclass('markdown-showblock-visible',!is)}el.find('b').html(el.attrd(is?'show':'hide'))})};(function Markdown(){var keywords=/\{.*?\}\(.*?\)/g;var linksexternal=/(https|http):\/\//;var format=/__.*?__|_.*?_|\*\*.*?\*\*|\*.*?\*|~~.*?~~|~.*?~/g,ordered=/^[a-z|0-9]{1}\.\s|^-\s/i,orderedsize=/^(\s|\t)+/;var code=/`.*?`/g,encodetags=/<|>/g,regdash=/-{2,}/g,regicons=/(^|[^\w]):((fab\s|far\s|fas\s|fal\s|fad|fa\s)fa-)?[a-z-]+:([^\w]|$)/g;var regemptychar=/\s|\W/,regtags=/<[^>]*>/g,encode=function(val){return'&'+(val==='<'?'lt':'gt')+';'};function markdown_code(value){return value?('<code>'+value.substring(1,value.length-1)+'</code>'):''}function markdown_imagelinks(value){if(!value)return'';var end=value.lastIndexOf(')')+1;var img=value.substring(0,end);var url=value.substring(end+2,value.length-1);var label=markdown_links(img);var footnote=label.substring(0,13);if(footnote==='<sup data-id='||footnote==='<span data-id'||label.substring(0,9)==='<a href="')return label;return'<a href="'+url+'"'+(linksexternal.test(url)?' target="_blank"':'')+'>'+label+'</a>'}function markdown_table(value,align,ishead){var columns=value.substring(1,value.length-1).split('|');var builder='';for(var i=0;i<columns.length;i++){var column=columns[i].trim();if(column.charAt(0)=='-')continue;var a=align[i];builder+='<'+(ishead?'th':'td')+(a&&a!=='left'?(' class="'+a+'"'):'')+'>'+column+'</'+(ishead?'th':'td')+'>'}return'<tr>'+builder+'</tr>'}function markdown_links(value){if(!value)return'';var end=value.lastIndexOf(']');var img=value.charAt(0)==='!';var text=value.substring(img?2:1,end);var link=value.substring(end+2,value.length-1);if((/^#\d+$/).test(link)){return(/^\d+$/).test(text)?'<sup data-id="{0}" class="markdown-footnote">{1}</sup>'.format(link.substring(1),text):'<span data-id="{0}" class="markdown-footnote">{1}</span>'.format(link.substring(1),text)}if(link.substring(0,4)==='www.')link='https://'+link;var nofollow=link.charAt(0)==='@'?' rel="nofollow"':linksexternal.test(link)?' target="_blank"':'';return'<a href="'+link+'"'+nofollow+'>'+text+'</a>'}function markdown_image(value){var end=value.lastIndexOf(']');var text=value.substring(2,end);var link=value.substring(end+2,value.length-1);var responsive=1,f=text.charAt(0);if(f==='+'){responsive=2;text=text.substring(1)}else if(f==='-'){responsive=3;text=text.substring(1)}return'<img src="'+link+'" alt="'+text+'"'+(responsive===1?' class="img-responsive"':responsive===3?' class="markdown-gallery"':'')+' border="0" loading="lazy" />'}function markdown_keywords(value){var keyword=value.substring(1,value.indexOf('}'));var type=value.substring(value.lastIndexOf('(')+1,value.lastIndexOf(')'));return'<span class="markdown-keyword" data-type="{0}">{1}</span>'.format(type,keyword)}function markdown_links2(value){value=value.substring(4,value.length-4);return'<a href="'+(value.isEmail()?'mailto:':linksexternal.test(value)?'':'http://')+value+'" target="_blank">'+value+'</a>'}function markdown_format(value,index,text){var p=text.charAt(index-1);var n=text.charAt(index+value.length);if((!p||regemptychar.test(p))&&(!n||regemptychar.test(n))){var beg='',end='',tag;if(value.indexOf('*')!==-1){tag=value.indexOf('**')===-1?'em':'strong';beg+='<'+tag+'>';end='</'+tag+'>'+end}if(value.indexOf('_')!==-1){tag=value.indexOf('__')===-1?'u':'b';beg+='<'+tag+'>';end='</'+tag+'>'+end}if(value.indexOf('~')!==-1){beg+='<strike>';end='</strike>'+end}var count=value.charAt(1)===value.charAt(0)?2:1;return beg+value.substring(count,value.length-count)+end}return value}function markdown_id(value){value=value.replace(regtags,'');return value.slug().replace(regdash,'-')}function markdown_icon(value){var beg=-1,end=-1;for(var i=0;i<value.length;i++){var code=value.charCodeAt(i);if(code===58){if(beg===-1)beg=i+1;else end=i}}var icon=value.substring(beg,end);if(icon.indexOf(' ')===-1)icon='fa fa-'+icon;return value.substring(0,beg-1)+'<i class="'+icon+'"></i>'+value.substring(end+1)}function markdown_urlify(str){return str.replace(/(^|\s)+(((https?:\/\/)|(www\.))[^\s]+)/g,function(url,b,c){var len=url.length,l=url.charAt(len-1);var f=url.charAt(0);if(l==='.'||l===',')url=url.substring(0,len-1);else l='';url=(c==='www.'?'http://'+url:url).trim();return(f.charCodeAt(0)<40?f:'')+'['+url+']('+url+')'+l})}FUNC.markdownredraw=function(el,opt){if(!el)el=opt.element||$('body');if(!opt)opt=EMPTYOBJECT;if(!opt.nosecret){el.find('.lang-secret').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);el.parent().replaceWith('<div class="markdown-secret" data-show="{0}" data-hide="{1}"><span class="markdown-showsecret"><i class="fa fa-lock"></i><i class="fa pull-right fa-angle-down"></i><b>{0}</b></span><div class="hidden">'.format(opt.showsecret||'Show secret data',opt.hidesecret||'Hide secret data')+el.html().trim().markdown(opt.secretoptions,true)+'</div></div>')})}if(!opt.novideo){el.find('.lang-video').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);var html=el.html();if(html.indexOf('youtube')!==-1)el.parent().replaceWith('<div class="markdown-video"><iframe src="https://www.youtube.com/embed/'+html.split('v=')[1]+'" frameborder="0" allowfullscreen></iframe></div>');else if(html.indexOf('vimeo')!==-1)el.parent().replaceWith('<div class="markdown-video"><iframe src="//player.vimeo.com/video/'+html.substring(html.lastIndexOf('/')+1)+'" frameborder="0" allowfullscreen></iframe></div>')})}if(!opt.nochart){el.find('.lang-barchart').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);var arr=el.html().split('\n').trim();var series=[],categories=[],y='';for(var i=0;i<arr.length;i++){var line=arr[i].split('|').trim();for(var j=1;j<line.length;j++){if(i===0)series.push({name:line[j],data:[]});else series[j-1].data.push(+line[j])}if(i)categories.push(line[0]);else y=line[0]}var options={chart:{height:300,type:'bar',},yaxis:{title:{text:y}},series:series,xaxis:{categories:categories,},fill:{opacity:1},},chart=new ApexCharts($(this).parent().empty()[0],options);chart.render()});el.find('.lang-linechart').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;if(!W.ApexCharts)return;var el=$(t);var arr=el.html().split('\n').trim();var series=[],categories=[],y='';for(var i=0;i<arr.length;i++){var line=arr[i].split('|').trim();for(var j=1;j<line.length;j++){if(i===0)series.push({name:line[j],data:[]});else series[j-1].data.push(+line[j])}if(i)categories.push(line[0]);else y=line[0]}var options={chart:{height:300,type:'line',},yaxis:{title:{text:y}},series:series,xaxis:{categories:categories,},fill:{opacity:1},},chart=new ApexCharts($(this).parent().empty()[0],options);chart.render()})}if(!opt.noiframe){el.find('.lang-iframe').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);el.parent().replaceWith('<div class="markdown-iframe">'+el.html().replace(/&lt;/g,'<').replace(/&gt;/g,'>')+'</div>')})}if(!opt.nocode){el.find('.markdown-code').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=true;W.hljs&&$(this).find('pre code').each(function(i,block){W.hljs.highlightBlock(block)})})}el.find('a').each(function(){var t=this;if(t.$mdloaded)return;t.$mdloaded=1;var el=$(t);var href=el.attr('href');var c=href.substring(0,1);if(href==='#'){var beg='',end='',text=el.html();if(text.substring(0,1)==='<')beg='-';if(text.substring(text.length-1)==='>')end='-';el.attr('href','#'+(beg+markdown_id(el.text())+end))}else if(c!=='/'&&c!=='#')el.attr('target','_blank')});EMIT('markdown',el,opt);el.find('.markdown-code').rclass('hidden')};Thelpers.markdown=function(val,opt){return val?(val+'').markdown(opt):val};String.prototype.markdown=function(opt,nested){var str=this;if(!opt)opt={};var lines=str.split('\n');var builder=[],ul=[],table=false,iscode=false,isblock=false,ishead=false,isprevblock=false,prev,prevsize=0,previndex,tmp;if(opt.wrap==null)opt.wrap=true;if(opt.linetag==null)opt.linetag='p';var closeul=function(){while(ul.length){var text=ul.pop();builder.push('</'+text+'>')}};var formatlinks=function(val){return markdown_links(val,opt.images)};var linkscope=function(val,index,callback){var beg=-1,beg2=-1,can=false,skip=false,find=false,n;for(var i=index;i<val.length;i++){var c=val.charAt(i);if(c==='['){beg=i;can=false;find=true;continue}var codescope=val.substring(i,i+6);if(skip&&codescope==='</code'){skip=false;i+=7;continue}if(skip)continue;if(!find&&codescope==='<code>'){skip=true;continue}var il=val.substring(i,i+4);if(il==='&lt;'){beg2=i;continue}else if(beg2>-1&&il==='&gt;'){callback(val.substring(beg2,i+4),true);beg2=-1;continue}if(c===']'){can=false;find=false;if(beg===-1)continue;n=val.charAt(i+1);if(n===' ')n=val.charAt(i+2);can=n==='('}if(beg>-1&&can&&c===')'){n=val.charAt(beg-1);callback(val.substring(beg-(n==='!'?1:0),i+1));can=false;find=false;beg=-1}}};var formatline=function(line){var tmp=[];return line.replace(code,function(text){tmp.push(text);return'\0'}).replace(format,markdown_format).replace(/\0/g,function(){return markdown_code(tmp.shift())})};var imagescope=function(val){var beg=-1,can=false,n;for(var i=0;i<val.length;i++){var c=val.charAt(i);if(c==='['){beg=i;can=false;continue}if(c===']'){can=false;if(beg===-1)continue;n=val.charAt(i+1);if(n===' ')n=val.charAt(i+2);can=n==='('}if(beg>-1&&can&&c===')'){n=val.charAt(beg-1);var tmp=val.substring(beg-(n==='!'?1:0),i+1);if(tmp.charAt(0)==='!')val=val.replace(tmp,markdown_image(tmp));can=false;beg=-1}}return val};for(var i=0;i<lines.length;i++){lines[i]=lines[i].replace(encodetags,encode);var three=lines[i].substring(0,3);if(!iscode&&(three===':::'||(three==='==='))){if(isblock){if(opt.blocks!==false)builder[builder.length-1]+='</div></div>';isblock=false;isprevblock=true;continue}closeul();isblock=true;if(opt.blocks!==false){line=lines[i].substring(3).trim();if(opt.formatting!==false)line=formatline(line);builder.push('<div class="markdown-block"><span class="markdown-showblock"><i class="fa fa-plus"></i>{0}</span><div class="hidden">'.format(line))}prev='';continue}if(!isblock&&lines[i]&&isprevblock){builder.push('<br />');isprevblock=false}if(three==='```'){if(iscode){if(opt.code!==false)builder[builder.length-1]+='</code></pre></div>';iscode=false;continue}closeul();iscode=true;if(opt.code!==false)tmp='<div class="markdown-code hidden"><pre><code class="lang-'+lines[i].substring(3)+'">';prev='code';continue}if(iscode){if(opt.code!==false)builder.push(tmp+lines[i]);if(tmp)tmp='';continue}var line=lines[i];if(opt.br!==false)line=line.replace(/&lt;br(\s\/)?&gt;/g,'<br />');if(line.length>10&&opt.urlify!==false&&opt.links!==false)line=markdown_urlify(line);if(opt.custom)line=opt.custom(line);if(line.length>2&&line!=='***'&&line!=='---'){if(opt.formatting!==false)line=formatline(line);if(opt.images!==false)line=imagescope(line);if(opt.links!==false){linkscope(line,0,function(text,inline){if(inline)line=line.replace(text,markdown_links2);else if(opt.images!==false)line=line.replace(text,markdown_imagelinks);else line=line.replace(text,formatlinks)})}if(opt.keywords!==false)line=line.replace(keywords,markdown_keywords);if(opt.icons!==false)line=line.replace(regicons,markdown_icon)}if(!line){if(table){table=null;if(opt.tables!==false)builder.push('</tbody></table>')}}if(line===''&&lines[i-1]===''){closeul();if(opt.emptynewline!==false)builder.push('<br />');prev='br';continue}if(line[0]==='|'){closeul();if(!table){var next=lines[i+1];if(next[0]==='|'){table=[];var columns=next.substring(1,next.length-1).split('|');for(var j=0;j<columns.length;j++){var column=columns[j].trim();var align='left';if(column.charAt(column.length-1)===':')align=column[0]===':'?'center':'right';table.push(align)}if(opt.tables!==false)builder.push('<table class="table table-bordered"><thead>');prev='table';ishead=true;i++}else continue}if(opt.tables!==false){if(ishead)builder.push(markdown_table(line,table,true)+'</thead><tbody>');else builder.push(markdown_table(line,table))}ishead=false;continue}if(line.charAt(0)==='#'){closeul();if(line.substring(0,2)==='# '){tmp=line.substring(2).trim();if(opt.headlines!==false)builder.push('<h1 id="'+markdown_id(tmp)+'">'+tmp+'</h1>');prev='#';continue}if(line.substring(0,3)==='## '){tmp=line.substring(3).trim();if(opt.headlines!==false)builder.push('<h2 id="'+markdown_id(tmp)+'">'+tmp+'</h2>');prev='##';continue}if(line.substring(0,4)==='### '){tmp=line.substring(4).trim();if(opt.headlines!==false)builder.push('<h3 id="'+markdown_id(tmp)+'">'+tmp+'</h3>');prev='###';continue}if(line.substring(0,5)==='#### '){tmp=line.substring(5).trim();if(opt.headlines!==false)builder.push('<h4 id="'+markdown_id(tmp)+'">'+tmp+'</h4>');prev='####';continue}if(line.substring(0,6)==='##### '){tmp=line.substring(6).trim();if(opt.headlines!==false)builder.push('<h5 id="'+markdown_id(tmp)+'">'+tmp+'</h5>');prev='#####';continue}}tmp=line.substring(0,3);if(tmp==='---'||tmp==='***'){prev='hr';if(opt.hr!==false)builder.push('<hr class="markdown-line'+(tmp.charAt(0)==='-'?'1':'2')+'" />');continue}if((/^#\d+:(\s)+/).test(line)){if(opt.footnotes!==false){tmp=line.indexOf(':');builder.push('<div class="markdown-footnotebody" data-id="{0}"><span>{0}:</span> {1}</div>'.format(line.substring(1,tmp).trim(),line.substring(tmp+1).trim()))}continue}if(line.substring(0,5)==='&gt; '){if(opt.blockquotes!==false)builder.push('<blockquote>'+line.substring(5).trim()+'</blockquote>');prev='>';continue}if(line.substring(0,5)==='&lt; '){if(opt.sections!==false)builder.push('<section>'+line.substring(5).trim()+'</section>');prev='<';continue}var tmpline=line.trim();if(opt.ul!==false&&ordered.test(tmpline)){var size=line.match(orderedsize);if(size)size=size[0].length;else size=0;var append=false;if(prevsize!==size){if(size>prevsize){prevsize=size;append=true;var index=builder.length-1;builder[index]=builder[index].substring(0,builder[index].length-5);prev=''}else{prevsize=size;builder.push('</'+ul.pop()+'>')}}var type=tmpline.charAt(0)==='-'?'ul':'ol';if(prev!==type){var subtype;if(type==='ol')subtype=tmpline.charAt(0);previndex=builder.push('<'+type+(subtype?(' type="'+subtype+'"'):'')+'>')-1;ul.push(type+(append?'></li':''));prev=type;prevsize=size}var tmpstr=(type==='ol'?tmpline.substring(tmpline.indexOf('.')+1):tmpline.substring(2));if(type!=='ol'){var tt=tmpstr.substring(0,3);if(tt==='[ ]'||tt==='[x]'){if(previndex!=null)builder[previndex]=builder[previndex].replace('<ul','<ul class="markdown-tasks"');previndex=null}}builder.push('<li>'+tmpstr.trim().replace(/\[x\]/g,'<i class="fa fa-check-square green"></i>').replace(/\[\s\]/g,'<i class="far fa-square"></i>')+'</li>')}else{closeul();line&&builder.push((opt.linetag?('<'+opt.linetag+'>'):'')+line.trim()+(opt.linetag?('</'+opt.linetag+'>'):''));prev='p'}}closeul();table&&opt.tables!==false&&builder.push('</tbody></table>');iscode&&opt.code!==false&&builder.push('</code></pre>');if(!opt.noredraw&&typeof(window)==='object')setTimeout(FUNC.markdownredraw,1,null,opt);return(opt.wrap?('<div class="markdown'+(nested?'':' markdown-container')+'">'):'')+builder.join('\n').replace(/\t/g,'    ')+(opt.wrap?'</div>':'')}})()});
// End: j-Markdown

// Component: j-Approve
// Version: 1
// Updated: 2021-02-11 09:41
COMPONENT('approve','cancel:Cancel',function(self,config,cls){var cls2='.'+cls,events={},buttons,oldcancel;self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){self.aclass(cls+' hidden');self.html('<div><div class="{0}-body"><span class="{0}-close"><i class="fa fa-times"></i></span><div class="{0}-content"></div><div class="{0}-buttons"><button data-index="0"></button><button data-index="1"></button></div></div></div>'.format(cls));buttons=self.find(cls2+'-buttons').find('button');self.event('click','button',function(){self.hide(+$(this).attrd('index'))});self.event('click',cls2+'-close',function(){self.callback=null;self.hide(-1)});self.event('click',function(e){var t=e.target.tagName;if(t!=='DIV')return;var el=self.find(cls2+'-body');el.aclass(cls+'-click');setTimeout(function(){el.rclass(cls+'-click')},300)})};events.keydown=function(e){var index=e.which===13?0:e.which===27?1:null;if(index!=null){self.find('button[data-index="{0}"]'.format(index)).trigger('click');e.preventDefault();e.stopPropagation();events.unbind()}};events.bind=function(){$(W).on('keydown',events.keydown)};events.unbind=function(){$(W).off('keydown',events.keydown)};self.show=function(message,a,b,fn){if(typeof(b)==='function'){fn=b;b=config.cancel}if(M.scope)self.currscope=M.scope();self.callback=fn;var icon=a.match(/"[a-z0-9-\s]+"/);if(icon){var tmp=icon+'';if(tmp.indexOf(' ')==-1)tmp='fa fa-'+tmp;a=a.replace(icon,'').trim();icon='<i class="{0}"></i>'.format(tmp.replace(/"/g,''))}else icon='';var color=a.match(/#[0-9a-f]+/i);if(color)a=a.replace(color,'').trim();buttons.eq(0).css('background-color',color||'').html(icon+a);if(oldcancel!==b){oldcancel=b;buttons.eq(1).html(b)}self.find(cls2+'-content').html(message.replace(/\n/g,'<br />'));$('html').aclass(cls+'-noscroll');self.rclass('hidden');events.bind();self.aclass(cls+'-visible',5);document.activeElement&&document.activeElement.blur()};self.hide=function(index){if(!index){self.currscope&&M.scope(self.currscope);self.callback&&self.callback(index)}self.rclass(cls+'-visible');events.unbind();setTimeout2(self.id,function(){$('html').rclass(cls+'-noscroll');self.aclass('hidden')},1000)}});
// End: j-Approve

// Component: j-NotifyBar
// Version: 1
// Updated: 2020-10-22 18:17
COMPONENT('notifybar','timeout:5000',function(self,config,cls){self.singleton();self.readonly();self.nocompile&&self.nocompile();self.history=[];var cls2='.'+cls,body,buttons,prevtype,timeout,currentindex=0;self.make=function(){self.aclass(cls+' hidden');self.append('<div class="{0}-controls"><button name="prev" disabled><i class="fa fa-angle-left"></i></button><button name="next" disabled><i class="fa fa-angle-right"></i></button></div><div class="{0}-body">OK</div>'.format(cls));self.event('click',cls2+'-body',self.hide);self.event('click','button',function(){self[this.name]()});body=self.find(cls2+'-body');buttons=self.find('button')};self.hide=function(){self.aclass('hidden')};self.next=function(){currentindex++;self.draw(config.timeout*2)};self.prev=function(){currentindex--;self.draw(config.timeout*2)};self.show=function(){currentindex=self.history.length-1;if(currentindex>=0){self.draw(config.timeout);self.check()}};self.draw=function(delay){prevtype&&self.rclass(cls+'-'+prevtype);var msg=self.history[currentindex];if(msg.body.indexOf('fa-')===-1)msg.body='<i class="fa fa-'+(msg.type===1?'check-circle':msg.type===2?'warning':'info-circle')+'"></i>'+msg.body;body.html(msg.body);buttons[0].disabled=!self.history.length||currentindex===0;buttons[1].disabled=!self.history.length||currentindex>=(self.history.length-1);prevtype=msg.type;self.aclass(cls+'-'+prevtype);self.rclass('hidden');timeout&&clearTimeout(timeout);timeout=setTimeout(self.hide,delay)};self.success=function(body){currentindex=self.history.push({type:1,body:body})-1;self.draw(config.timeout);self.check()};self.warning=function(body){currentindex=self.history.push({type:2,body:body})-1;self.draw(config.timeout);self.check()};self.response=function(message,callback,response){var fn;if(typeof(message)==='function'){response=callback;fn=message;message=null}else if(typeof(callback)==='function')fn=callback;else{response=callback;fn=null}if(response instanceof Array){var builder=[];for(var i=0;i<response.length;i++){var err=response[i].error;err&&builder.push(err)}self.warning(builder.join('<br />'))}else if(typeof(response)==='string')self.warning(response);else{if(message){if(message.length<40&&message.charAt(0)==='?')SET(message,response);else self.success(message)}if(typeof(fn)==='string')SET(fn,response);else if(fn)fn(response)}};self.info=function(body){currentindex=self.history.push({type:3,body:body})-1;self.draw(config.timeout);self.check()};self.check=function(){if(self.history.length>20)self.history.unshift()}});
// End: j-NotifyBar

// Component: j-Menu
// Version: 1
// Updated: 2020-12-03 11:08
COMPONENT('menu',function(self,config,cls){self.singleton();self.readonly();self.nocompile&&self.nocompile();var cls2='.'+cls,is=false,issubmenu=false,isopen=false,events={},ul,children,prevsub,parentclass;self.make=function(){self.aclass(cls+' hidden '+cls+'-style-'+(config.style||1));self.append('<div class="{0}-items"><ul></ul></div><div class="{0}-submenu hidden"><ul></ul></div>'.format(cls));ul=self.find(cls2+'-items').find('ul');children=self.find(cls2+'-submenu');self.event('click','li',function(e){clearTimeout2(self.ID);var el=$(this);if(!el.hclass(cls+'-divider')&&!el.hclass(cls+'-disabled')){self.opt.scope&&M.scope(self.opt.scope);var index=el.attrd('index').split('-');if(index.length>1){self.opt.callback(self.opt.items[+index[0]].children[+index[1]]);self.hide()}else if(!issubmenu){self.opt.callback(self.opt.items[+index[0]]);self.hide()}}e.preventDefault();e.stopPropagation()});events.hide=function(){is&&self.hide()};self.event('scroll',events.hide);self.on('reflow + scroll + resize + resize2',events.hide);events.click=function(e){if(is&&!isopen&&(!self.target||(self.target!==e.target&&!self.target.contains(e.target))))setTimeout2(self.ID,self.hide,isMOBILE?700:300)};events.hidechildren=function(){if($(this.parentNode.parentNode).hclass(cls+'-items')){if(prevsub&&prevsub[0]!==this){prevsub.rclass(cls+'-selected');prevsub=null;children.aclass('hidden');issubmenu=false}}};events.children=function(){if(prevsub&&prevsub[0]!==this){prevsub.rclass(cls+'-selected');prevsub=null}issubmenu=true;isopen=true;setTimeout(function(){isopen=false},500);var el=prevsub=$(this);var index=+el.attrd('index');var item=self.opt.items[index];el.aclass(cls+'-selected');var html=self.makehtml(item.children,index);children.find('ul').html(html);children.rclass('hidden');var css={},offset=el.position();css.left=ul.width()-5;css.top=offset.top-5;var offsetX=offset.left;offset=self.element.offset();var w=children.width();var left=offset.left+css.left+w;if(left>WW+30)css.left=(offsetX-w)+5;children.css(css)}};self.bindevents=function(){events.is=true;$(document).on('touchstart mouseenter mousedown',cls2+'-children',events.children).on('touchstart mousedown',events.click);$(W).on('scroll',events.hide);self.element.on('mouseenter','li',events.hidechildren)};self.unbindevents=function(){events.is=false;$(document).off('touchstart mouseenter mousedown',cls2+'-children',events.children).off('touchstart mousedown',events.click);$(W).off('scroll',events.hide);self.element.off('mouseenter','li',events.hidechildren)};self.showxy=function(x,y,items,callback){var opt={};opt.x=x;opt.y=y;opt.items=items;opt.callback=callback;self.show(opt)};self.makehtml=function(items,index){var builder=[],tmp;for(var i=0;i<items.length;i++){var item=items[i];if(typeof(item)==='string'){if(item==='-')tmp='<hr />';else tmp='<span>{0}</span>'.format(item);builder.push('<li class="{0}-divider">{1}</li>'.format(cls,tmp));continue}var cn=item.classname||'',icon='';if(item.icon)icon='<i class="{0}"></i>'.format(item.icon.charAt(0)==='!'?item.icon.substring(1):item.icon.indexOf('fa-')===-1?('fa fa-'+item.icon):item.icon);else cn=(cn?(cn+' '):'')+cls+'-nofa';tmp='';if(index==null&&item.children&&item.children.length){cn+=(cn?' ':'')+cls+'-children';tmp+='<i class="fa fa-play pull-right"></i>'}if(item.selected)cn+=(cn?' ':'')+cls+'-selected';if(item.disabled)cn+=(cn?' ':'')+cls+'-disabled';tmp+='<div class="{0}-name">{1}{2}{3}</div>'.format(cls,icon,item.name,item.shortcut?'<b>{0}</b>'.format(item.shortcut):'');if(item.note)tmp+='<div class="ui-menu-note">{0}</div>'.format(item.note);builder.push('<li class="{0}" data-index="{2}">{1}</li>'.format(cn,tmp,(index!=null?(index+'-'):'')+i))}return builder.join('')};self.show=function(opt){if(typeof(opt)==='string'){opt={align:opt};opt.element=arguments[1];opt.items=arguments[2];opt.callback=arguments[3];opt.offsetX=arguments[4];opt.offsetY=arguments[5]}var tmp=opt.element?opt.element instanceof jQuery?opt.element[0]:opt.element.element?opt.element.dom:opt.element:null;if(is&&tmp&&self.target===tmp){self.hide();return}var tmp;self.target=tmp;self.opt=opt;opt.scope=M.scope();if(parentclass&&opt.classname!==parentclass){self.rclass(parentclass);parentclass=null}if(opt.large)self.aclass('ui-large');else self.rclass('ui-large');isopen=false;issubmenu=false;prevsub=null;var css={};children.aclass('hidden');children.find('ul').empty();clearTimeout2(self.ID);ul.html(self.makehtml(opt.items));if(!parentclass&&opt.classname){self.aclass(opt.classname);parentclass=opt.classname}if(is){css.left=0;css.top=0;self.element.css(css)}else{self.rclass('hidden');self.aclass(cls+'-visible',100);is=true;if(!events.is)self.bindevents()}var target=$(opt.element);var w=self.width();var offset=target.offset();if(opt.element){switch(opt.align){case'center':css.left=Math.ceil((offset.left-w/2)+(target.innerWidth()/2));break;case'right':css.left=(offset.left-w)+target.innerWidth();break;default:css.left=offset.left;break}css.top=opt.position==='bottom'?(offset.top-self.element.height()-10):(offset.top+target.innerHeight()+10)}else{css.left=opt.x;css.top=opt.y}if(opt.position==='bottom')css.top+=10;else css.top-=10;if(opt.offsetX)css.left+=opt.offsetX;if(opt.offsetY)css.top+=opt.offsetY;var mw=w,mh=self.height();if(css.left<0)css.left=10;else if((mw+css.left)>WW)css.left=(WW-mw)-10;if(css.top<0)css.top=10;else if((mh+css.top)>WH)css.top=(WH-mh)-10;self.element.css(css)};self.hide=function(){events.is&&self.unbindevents();is=false;self.opt&&self.opt.hide&&self.opt.hide();self.target=null;self.opt=null;self.aclass('hidden');self.rclass(cls+'-visible')}});
// End: j-Menu

// Component: j-Panel
// Version: 1
// Updated: 2021-03-26 16:20
COMPONENT('panel','width:350;icon:home;zindex:12;scrollbar:true;scrollbarY:true;margin:0;padding:20;closeicon:fa fa-times',function(self,config,cls){var cls2='.'+cls;if(!W.$$panel){W.$$panel_level=W.$$panel_level||1;W.$$panel=true;$(document).on('click touchend',cls2+'-button-close,'+cls2+'-container',function(e){var target=$(e.target);var curr=$(this);var main=target.hclass(cls+'-container');if(curr.hclass(cls+'-button-close')||main){var parent=target.closest(cls2+'-container');var com=parent.component();if(!main||com.config.bgclose){if(com.config.close)com.EXEC(com.config.close,com);else com.hide();e.preventDefault();e.stopPropagation()}}});var resize=function(){SETTER('panel/resize')};ON('resize + resize2',function(){setTimeout2('panelresize',resize,100)})}self.icon=function(value,path,el){el.rclass().aclass(cls+'-icon '+self.faicon(value.icon))};self.readonly();self.hide=function(){self.set('')};self.resize=function(){var el=self.element.find(cls2+'-body');var h=WH-self.find(cls2+'-header').height()-(config.padding*2);el.height(h);config.container&&el.find(config.container).height(h-config.margin);self.scrollbar&&self.scrollbar.resize()};self.make=function(){var scr=self.find('> script');self.template=scr.length?scr.html():'';$(document.body).append('<div id="{0}" class="hidden {5}-container{3}"><div class="{5}" style="max-width:{1}px"><div data-bind="@config__change .ui-panel-icon:@icon__html span:value.title" class="{5}-title"><button name="cancel" class="{5}-button-close{2}"><i class="{6}"></i></button><button name="menu" class="{5}-button-menu{4}"><i class="fa fa-ellipsis-h"></i></button><i class="{5}-icon"></i><span></span></div><div class="{5}-header"></div><div class="{5}-body"></div></div>'.format(self.ID,config.width,config.closebutton==false?' hidden':'',config.bg?'':' ui-panel-inline',config.menu?'':' hidden',cls,config.closeicon));var el=$('#'+self.ID);var body=el.find(cls2+'-body');while(self.dom.children.length)body[0].appendChild(self.dom.children[0]);self.rclass('hidden');self.replace(el,true);if(config.scrollbar&&window.SCROLLBAR){if(config.container)body=body.find(config.container);self.scrollbar=SCROLLBAR(body,{shadow:config.scrollbarshadow,visibleY:!!config.scrollbarY,orientation:'y'});self.scrollleft=self.scrollbar.scrollLeft;self.scrolltop=self.scrollbar.scrollTop;self.scrollright=self.scrollbar.scrollRight;self.scrollbottom=self.scrollbar.scrollBottom}else body.aclass(cls+'-scroll');self.event('click','button[name],.cancel',function(){switch(this.name){case'menu':EXEC(config.menu,$(this),self);break;case'cancel':self.hide();break;default:if($(this).hclass('cancel'))self.hide();break}});self.resize()};self.configure=function(key,value,init){switch(key){case'bg':self.tclass(cls+'-inline',!value);self.element.css('max-width',value?'inherit':(config.width+1));break;case'closebutton':!init&&self.find(cls2+'-button-close').tclass(value!==true);break;case'width':self.element.css('max-width',config.bg?'inherit':value);self.find(cls2+'').css('max-width',value);break}};self.setter=function(value){setTimeout2(cls+'-noscroll',function(){$('html').tclass(cls+'-noscroll',!!$(cls2+'-container').not('.hidden').length)},50);var isHidden=value!==config.if;if(self.hclass('hidden')===isHidden){if(!isHidden){config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true)}return}setTimeout2('panelreflow',function(){EMIT('reflow',self.name)},10);if(isHidden){self.aclass('hidden');self.release(true);self.rclass(cls+'-animate');W.$$panel_level--;return}if(self.template){var is=self.template.COMPILABLE();self.find('div[data-jc-replaced]').html(self.template);self.template=null;is&&COMPILE()}if(W.$$panel_level<1)W.$$panel_level=1;W.$$panel_level++;var container=self.element.find(cls2+'-body');self.css('z-index',W.$$panel_level*config.zindex);container.scrollTop(0);self.rclass('hidden');self.release(false);setTimeout(self.resize,100);config.reload&&self.EXEC(config.reload,self);config.refresh&&self.EXEC(config.refresh,self);config.default&&DEFAULT(self.makepath(config.default),true);if(!isMOBILE&&config.autofocus){var el=self.find(config.autofocus?'input[type="text"],select,textarea':config.autofocus);el.length&&setTimeout(function(el){el.focus()},500,el[0])}setTimeout(function(){if(self.scrollbar)self.scrollbar.scroll(0,0);else container.scrollTop(0);self.aclass(cls+'-animate')},300);setTimeout2(self.id,function(){self.css('z-index',(W.$$panel_level*config.zindex)+1)},1000)}});
// End: j-Panel

// Component: Tangular-JsonFormat
// Version: 1
// Updated: 2021-01-28 10:30
Thelpers.jsonformat=function(json,format){var reguid2=/"{14,}[a-z]{3}[01]{1}|^\d{9,14}[a-z]{2}[01]{1}a|"\d{4,18}[a-z]{2}\d{1}[01]{1}b|"[0-9a-f]{4,18}[a-z]{2}\d{1}[01]{1}c|"[0-9a-z]{4,18}[a-z]{2}\d{1}[01]{1}d/;if(typeof(json)==='object')json=JSON.stringify(json,null,'\t');return json.replace(/\t.*?:\s/g,function(text){return'<span class="json-key">'+text+'</span>'}).replace(/\/span>(false|true)/g,function(val){val=val.substring(6);return'/span><span class="json-boolean json-'+val+'">'+val+'</span>'}).replace(/\/span>[\d.]+/g,function(val){return'/span><span class="json-number">'+val.substring(6)+'</span>'}).replace(/\/span>"[\d-]+T[\d:.]+Z"/g,function(val){return'/span><span class="json-date">'+new Date(val.substring(7,val.length-1)).format(format||'yyyy-MM-dd HH:mm:ss')+'</span>'}).replace(/\/span>null/g,function(){return'/span><span class="json-null">null</span>'}).replace(/\/span>"#[a-f0-9]{6}"/gi,function(val){val=val.substring(7,val.length-1);return'/span>"<span class="json-color" style="color:'+val+'">'+val+'</span>"'}).replace(reguid2,function(text){return'<span class="json-uid">'+text+'</span>'})};
// End: Tangular-JsonFormat

// Component: j-Importer
// Version: 1
// Updated: 2021-03-29 11:15
COMPONENT('importer',function(self,config){var init=false,clid=null,pending=false,content='',replace=function(value){return self.scope?self.makepath(value):value.replace(/\?/g,config.path||config.if)};var replace2=function(value){return value?value.replace(/~PATH~/g,config.path||config.if):value};self.readonly();self.make=function(){var scr=self.find('script');content=scr.length?scr.html():''};self.reload=function(recompile){config.reload&&EXEC(replace(config.reload));recompile&&COMPILE();setTimeout(function(){pending=false;init=true},1000)};self.setter=function(value){if(pending)return;if(config.if!==value){if(config.cleaner&&init&&!clid)clid=setTimeout(self.clean,config.cleaner*60000);return}pending=true;if(clid){clearTimeout(clid);clid=null}if(init){self.reload();return}if(content){self.html(replace2(content));setTimeout(self.reload,50,true)}else self.import(config.url,self.reload,true,replace2)};self.clean=function(){config.clean&&EXEC(replace(config.clean));setTimeout(function(){self.empty();init=false;clid=null},1000)}});
// End: j-Importer

// Component: j-Form
// Version: 2
// Updated: 2021-04-08 10:52
COMPONENT('form','zindex:12;scrollbar:1',function(self,config,cls){var cls2='.'+cls,container,csspos={};if(!W.$$form){W.$$form_level=W.$$form_level||1;W.$$form=true;$(document).on('click',cls2+'-button-close',function(){SET($(this).attrd('path'),'')});var resize=function(){setTimeout2('form',function(){for(var i=0;i<M.components.length;i++){var com=M.components[i];if(com.name==='form'&&!HIDDEN(com.dom)&&com.$ready&&!com.$removed)com.resize()}},200)};ON('resize2',resize);$(document).on('click',cls2+'-container',function(e){var el=$(e.target);if(e.target===this||el.hclass(cls+'-container-padding')){var com=$(this).component();if(com&&com.config.closeoutside){com.set('');return}}if(!(el.hclass(cls+'-container-padding')||el.hclass(cls+'-container')))return;var form=$(this).find(cls2);var c=cls+'-animate-click';form.aclass(c);setTimeout(function(){form.rclass(c)},300)})}self.readonly();self.submit=function(){if(config.submit)self.EXEC(config.submit,self.hide,self.element);else self.hide()};self.cancel=function(){config.cancel&&self.EXEC(config.cancel,self.hide);self.hide()};self.hide=function(){if(config.independent)self.hideforce();self.esc(false);self.set('')};self.icon=function(value){var el=this.rclass2('fa');value.icon&&el.aclass(value.icon.indexOf(' ')===-1?('fa fa-'+value.icon):value.icon);el.tclass('hidden',!value.icon)};self.resize=function(){if(self.scrollbar){container.css('height',WH);self.scrollbar.resize()}if(!config.center||self.hclass('hidden'))return;var ui=self.find(cls2);var fh=ui.innerHeight();var wh=WH,r=(wh/2)-(fh/2);csspos.marginTop=(r>30?(r-15):20)+'px';ui.css(csspos)};self.make=function(){$(document.body).append('<div id="{0}" class="hidden {4}-container invisible"><div class="{4}-scrollbar"><div class="{4}-container-padding"><div class="{4}" style="max-width:{1}px"><div data-bind="@config__text span:value.title__change .{4}-icon:@icon" class="{4}-title"><button name="cancel" class="{4}-button-close{3}" data-path="{2}"><i class="fa fa-times"></i></button><i class="{4}-icon"></i><span></span></div></div></div></div>'.format(self.ID,config.width||800,self.path,config.closebutton==false?' hidden':'',cls));var scr=self.find('> script');self.template=scr.length?scr.html().trim():'';if(scr.length)scr.remove();var el=$('#'+self.ID);var body=el.find(cls2)[0];container=el.find(cls2+'-scrollbar');if(config.scrollbar){el.css('overflow','hidden');self.scrollbar=SCROLLBAR(el.find(cls2+'-scrollbar'),{visibleY:1,orientation:'y'})}while(self.dom.children.length)body.appendChild(self.dom.children[0]);self.rclass('hidden invisible');self.replace(el,true);self.event('scroll',function(){EMIT('scroll',self.name);EMIT('reflow',self.name)});self.event('click','button[name]',function(){var t=this;switch(t.name){case'submit':self.submit(self.hide);break;case'cancel':!t.disabled&&self[t.name](self.hide);break}});config.enter&&self.event('keydown','input',function(e){e.which===13&&!self.find('button[name="submit"]')[0].disabled&&setTimeout(self.submit,800)})};self.configure=function(key,value,init,prev){if(init)return;switch(key){case'width':value!==prev&&self.find(cls2).css('max-width',value+'px');break;case'closebutton':self.find(cls2+'-button-close').tclass('hidden',value!==true);break}};self.esc=function(bind){if(bind){if(!self.$esc){self.$esc=true;$(W).on('keydown',self.esc_keydown)}}else{if(self.$esc){self.$esc=false;$(W).off('keydown',self.esc_keydown)}}};self.esc_keydown=function(e){if(e.which===27&&!e.isPropagationStopped()){var val=self.get();if(!val||config.if===val){e.preventDefault();e.stopPropagation();self.hide()}}};self.hideforce=function(){if(!self.hclass('hidden')){self.aclass('hidden');self.release(true);self.find(cls2).rclass(cls+'-animate');W.$$form_level--}};var allowscrollbars=function(){$('html').tclass(cls+'-noscroll',!!$(cls2+'-container').not('.hidden').length)};self.setter=function(value){setTimeout2(self.name+'-noscroll',allowscrollbars,50);var isHidden=value!==config.if;if(self.hclass('hidden')===isHidden){if(!isHidden){config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true)}return}setTimeout2(cls,function(){EMIT('reflow',self.name)},10);if(isHidden){if(!config.independent)self.hideforce();return}if(self.template){var is=self.template.COMPILABLE();self.find(cls2).append(self.template);self.template=null;is&&COMPILE()}if(W.$$form_level<1)W.$$form_level=1;W.$$form_level++;self.css('z-index',W.$$form_level*config.zindex);self.aclass('invisible');self.rclass('hidden');self.resize();self.release(false);if(self.scrollbar)self.scrollbar.scrollTop(0);else self.element.scrollTop(0);config.reload&&self.EXEC(config.reload,self);config.default&&DEFAULT(self.makepath(config.default),true);if(!isMOBILE&&config.autofocus){setTimeout(function(){self.find(typeof(config.autofocus)==='string'?config.autofocus:'input[type="text"],select,textarea').eq(0).focus()},1000)}setTimeout(function(){self.rclass('invisible');if(self.scrollbar)self.scrollbar.scrollTop(0);else self.element.scrollTop(0);self.find(cls2).aclass(cls+'-animate')},200);setTimeout2(self.ID,function(){self.css('z-index',(W.$$form_level*config.zindex)+1)},500);config.closeesc&&self.esc(true)}});
// End: j-Form

// Component: j-Input
// Version: 1
// Updated: 2021-04-26 15:58
COMPONENT('input','maxlength:200;dirkey:name;dirvalue:id;increment:1;autovalue:name;direxclude:false;forcevalidation:1;searchalign:1;after:\\:',function(self,config,cls){var cls2='.'+cls,input,placeholder,dirsource,binded,customvalidator,mask,rawvalue,isdirvisible=false,nobindcamouflage=false,focused=false;self.nocompile();self.bindvisible(20);self.init=function(){Thelpers.ui_input_icon=function(val){return val.charAt(0)==='!'||val.indexOf(' ')!==-1?('<span class="ui-input-icon-custom">'+(val.charAt(0)==='!'?val.substring(1):('<i class="'+val)+'"></i>')+'</span>'):('<i class="fa fa-'+val+'"></i>')};W.ui_input_template=Tangular.compile(('{{ if label}}<div class="{0}-label">{{ if icon}}<i class="{{ icon}}"></i>{{ fi}}{{ label | raw}}{{ after | raw}}</div>{{ fi}}<div class="{0}-control{{ if licon}} {0}-licon{{ fi}}{{ if ricon || (type === \'number\' && increment) }} {0}-ricon{{ fi}}">{{ if ricon || (type === \'number\' && increment) }}<div class="{0}-icon-right{{ if type === \'number\' && increment && !ricon}} {0}-increment{{ else if riconclick || type === \'date\' || type === \'time\' || (type === \'search\' && searchalign === 1) || type === \'password\' }} {0}-click{{ fi}}">{{ if type === \'number\' && !ricon}}<i class="fa fa-caret-up"></i><i class="fa fa-caret-down"></i>{{ else}}{{ ricon | ui_input_icon}}{{ fi}}</div>{{ fi}}{{ if licon}}<div class="{0}-icon-left{{ if liconclick || (type === \'search\' && searchalign !== 1) }} {0}-click{{ fi}}">{{ licon | ui_input_icon}}</div>{{ fi}}<div class="{0}-input{{ if align === 1 || align === \'center\' }} center{{ else if align === 2 || align === \'right\' }} right{{ fi}}">{{ if placeholder && !innerlabel}}<div class="{0}-placeholder">{{ placeholder}}</div>{{ fi}}{{ if dirsource || type === \'icon\' || type === \'emoji\' || type === \'color\' }}<div class="{0}-value" tabindex="0"></div>{{ else}}<input type="{{ if type === \'password\' }}password{{ else}}text{{ fi}}"{{ if autofill}} autocomplete="on" name="{{ PATH}}"{{ else}} name="input'+Date.now()+'" autocomplete="new-password"{{ fi}} data-jc-bind=""{{ if maxlength > 0}} maxlength="{{ maxlength}}"{{ fi}}{{ if autofocus}} autofocus{{ fi}} />{{ fi}}</div></div>{{ if error}}<div class="{0}-error hidden"><i class="fa fa-warning"></i> {{ error}}</div>{{ fi}}').format(cls))};self.make=function(){if(!config.label)config.label=self.html();if(isMOBILE&&config.autofocus)config.autofocus=false;config.PATH=self.path.replace(/\./g,'_');self.aclass(cls+' invisible');self.rclass('invisible',100);self.redraw();self.event('input change',function(){if(nobindcamouflage)nobindcamouflage=false;else self.check()});self.event('focus','input,'+cls2+'-value',function(){if(config.disabled){$(this).blur();return}focused=true;self.camouflage(false);self.aclass(cls+'-focused');config.autocomplete&&EXEC(self.makepath(config.autocomplete),self,input.parent());if(config.autosource){var opt={};opt.element=self.element;opt.search=GET(self.makepath(config.autosource));opt.callback=function(value){var val=typeof(value)==='string'?value:value[config.autovalue];if(config.autoexec){EXEC(self.makepath(config.autoexec),value,function(val){self.set(val,2);self.change();self.bindvalue()})}else{self.set(val,2);self.change();self.bindvalue()}};SETTER('autocomplete','show',opt)}else if(config.mask){setTimeout(function(input){input.selectionStart=input.selectionEnd=0},50,this)}else if(config.dirsource&&(config.autofocus!=false&&config.autofocus!=0)){if(!isdirvisible)self.find(cls2+'-control').trigger('click')}else if(config.type==='date'||config.type==='time'){setTimeout(function(){self.element.find(cls2+'-icon-right').trigger('click')},300)}});self.event('paste','input',function(e){if(config.mask){var val=(e.originalEvent.clipboardData||window.clipboardData).getData('text');self.set(val.replace(/\s|\t/g,''));e.preventDefault()}self.check()});self.event('keydown','input',function(e){var t=this,code=e.which;if(t.readOnly||config.disabled){if(e.keyCode!==9){if(config.dirsource){self.find(cls2+'-control').trigger('click');return}e.preventDefault();e.stopPropagation()}return}if(!config.disabled&&config.dirsource&&(code===13||code>30)){self.find(cls2+'-control').trigger('click');return}if(config.mask){if(e.metaKey){if(code===8||code===127){e.preventDefault();e.stopPropagation()}return}if(code===32){e.preventDefault();e.stopPropagation();return}var beg=e.target.selectionStart,end=e.target.selectionEnd,val=t.value,c;if(code===8||code===127){if(beg===end){c=config.mask.substring(beg-1,beg);t.value=val.substring(0,beg-1)+c+val.substring(beg);self.curpos(beg-1)}else{for(var i=beg;i<=end;i++){c=config.mask.substring(i-1,i);val=val.substring(0,i-1)+c+val.substring(i)}t.value=val;self.curpos(beg)}e.preventDefault();return}if(code>40){var cur=String.fromCharCode(code);if(mask&&mask[beg]){if(!mask[beg].test(cur)){e.preventDefault();return}}c=config.mask.charCodeAt(beg);if(c!==95){beg++;while(true){c=config.mask.charCodeAt(beg);if(c===95||isNaN(c))break;else beg++}}if(c===95){val=val.substring(0,beg)+cur+val.substring(beg+1);t.value=val;beg++;while(beg<config.mask.length){c=config.mask.charCodeAt(beg);if(c===95)break;else beg++}self.curpos(beg)}else self.curpos(beg+1);e.preventDefault();e.stopPropagation()}}});self.event('blur','input,'+cls2+'-value',function(){focused=false;self.camouflage(true);self.rclass(cls+'-focused')});self.event('click',cls2+'-control',function(){if(config.disabled||isdirvisible)return;if(config.type==='icon'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(val){self.change(true);self.set(val);self.check();rawvalue.focus()};SETTER('faicons','show',opt);return}else if(config.type==='color'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(al){self.change(true);self.set(al);self.check();rawvalue.focus()};SETTER('colorpicker','show',opt);return}else if(config.type==='emoji'){opt={};opt.element=self.element;opt.value=self.get();opt.empty=true;opt.callback=function(al){self.change(true);self.set(al);self.check();rawvalue.focus()};SETTER('emoji','show',opt);return}if(!config.dirsource)return;isdirvisible=true;setTimeout(function(){isdirvisible=false},500);var opt={};opt.element=self.find(cls2+'-control');opt.items=dirsource||GET(self.makepath(config.dirsource));opt.offsetY=-1+(config.diroffsety||0);opt.offsetX=0+(config.diroffsetx||0);opt.placeholder=config.dirplaceholder;opt.render=config.dirrender?GET(self.makepath(config.dirrender)):null;opt.custom=!!config.dircustom;opt.offsetWidth=2;opt.minwidth=config.dirminwidth||200;opt.maxwidth=config.dirmaxwidth;opt.key=config.dirkey||config.key;opt.empty=config.dirempty;if(config.dirraw)opt.raw=true;if(config.dirsearch!=null)opt.search=config.dirsearch;var val=self.get();opt.selected=val;if(dirsource&&config.direxclude==false){for(var i=0;i<dirsource.length;i++){var item=dirsource[i];if(item)item.selected=typeof(item)==='object'&&item[config.dirvalue]===val}}else if(config.direxclude){opt.exclude=function(item){return item?item[config.dirvalue]===val:false}}opt.callback=function(item,el,custom){if(item==null){rawvalue.html('');self.set(null,2);self.change();self.check();return}var val=custom||typeof(item)==='string'?item:item[config.dirvalue||config.value];if(custom&&typeof(config.dircustom)==='string'){var fn=GET(config.dircustom);fn(val,function(val){self.set(val,2);self.change();self.bindvalue()})}else if(custom){if(val){self.set(val,2);self.change();if(dirsource)self.bindvalue();else input.val(val)}}else{self.set(val,2);self.change();if(dirsource)self.bindvalue();else input.val(val)}rawvalue.focus()};SETTER('directory','show',opt)});self.event('click',cls2+'-placeholder,'+cls2+'-label',function(e){if(!config.disabled){if(config.dirsource){e.preventDefault();e.stopPropagation();self.find(cls2+'-control').trigger('click')}else if(!config.camouflage||$(e.target).hclass(cls+'-placeholder')){if(input.length)input.focus();else rawvalue.focus()}}});self.event('click',cls2+'-icon-left,'+cls2+'-icon-right',function(e){if(config.disabled)return;var el=$(this);var left=el.hclass(cls+'-icon-left');var opt;if(config.dirsource&&left&&config.liconclick){e.preventDefault();e.stopPropagation()}if(!left&&!config.riconclick){if(config.type==='date'){opt={};opt.element=self.element;opt.value=self.get();opt.callback=function(val){self.change(true);self.set(val)};SETTER('datepicker','show',opt)}else if(config.type==='time'){opt={};opt.element=self.element;opt.value=self.get();opt.callback=function(val){self.change(true);self.set(val)};SETTER('timepicker','show',opt)}else if(config.type==='search')self.set('');else if(config.type==='password')self.password();else if(config.type==='number'){var tmp=$(e.target);if(tmp.attr('class').indexOf('fa-')!==-1){var n=tmp.hclass('fa-caret-up')?1:-1;self.change(true);var val=self.preparevalue((self.get()||0)+(config.increment*n));self.set(val,2)}}return}if(left&&config.liconclick)EXEC(self.makepath(config.liconclick),self,el);else if(config.riconclick)EXEC(self.makepath(config.riconclick),self,el);else if(left&&config.type==='search')self.set('')})};self.camouflage=function(is){if(config.camouflage){if(is){var t=input[0],arr=t.value.split('');for(var i=0;i<arr.length;i++)arr[i]=typeof(config.camouflage)==='string'?config.camouflage:'*';nobindcamouflage=true;t.value=arr.join('')}else{nobindcamouflage=true;var val=self.get();input[0].value=val==null?'':val}self.tclass(cls+'-camouflaged',is)}};self.curpos=function(pos){var el=input[0];if(el.createTextRange){var range=el.createTextRange();range.move('character',pos);range.select()}else if(el.selectionStart){el.focus();el.setSelectionRange(pos,pos)}};self.validate=function(value){if((!config.required||config.disabled)&&!self.forcedvalidation())return true;if(config.dirsource)return!!value;if(customvalidator)return customvalidator(value);if(self.type==='date')return value instanceof Date&&!isNaN(value.getTime());if(value==null)value='';else value=value.toString();if(config.mask&&typeof(value)==='string'&&value.indexOf('_')!==-1)return false;if(config.minlength&&value.length<config.minlength)return false;switch(self.type){case'email':return value.isEmail();case'phone':return value.isPhone();case'url':return value.isURL();case'zip':return(/^\d{5}(?:[-\s]\d{4})?$/).test(value);case'currency':case'number':value=value.parseFloat();if((config.minvalue!=null&&value<config.minvalue)||(config.maxvalue!=null&&value>config.maxvalue))return false;return config.minvalue==null?value>0:true}return value.length>0};self.offset=function(){var offset=self.element.offset();var control=self.find(cls2+'-control');var width=control.width()+2;return{left:offset.left,top:control.offset().top+control.height(),width:width}};self.password=function(show){var visible=show==null?input.attr('type')==='text':show;input.attr('type',visible?'password':'text');self.find(cls2+'-icon-right').find('i').tclass(config.ricon,visible).tclass('fa-eye-slash',!visible)};self.preparevalue=function(value){if(self.type==='number'&&(config.minvalue!=null||config.maxvalue!=null)){var tmp=typeof(value)==='string'?+value.replace(',','.'):value;if(config.minvalue>tmp)value=config.minvalue;if(config.maxvalue<tmp)value=config.maxvalue}return value};self.getterin=self.getter;self.getter=function(value,realtime,nobind){if(nobindcamouflage)return;if(config.mask&&config.masktidy){var val=[];for(var i=0;i<value.length;i++){if(config.mask.charAt(i)==='_')val.push(value.charAt(i))}value=val.join('')}self.getterin(self.preparevalue(value),realtime,nobind)};self.setterin=self.setter;self.setter=function(value,path,type){if(config.mask){if(value){if(config.masktidy){var index=0,val=[];for(var i=0;i<config.mask.length;i++){var c=config.mask.charAt(i);val.push(c==='_'?(value.charAt(index++)||'_'):c)}value=val.join('')}if(mask){var arr=[];for(var i=0;i<mask.length;i++){var c=value.charAt(i);if(mask[i]&&mask[i].test(c))arr.push(c);else arr.push(config.mask.charAt(i))}value=arr.join('')}}else value=config.mask}self.setterin(value,path,type);self.bindvalue();config.camouflage&&!focused&&setTimeout(self.camouflage,type===1?1000:1,true);if(config.type==='password')self.password(true)};self.check=function(){var is=false;if(config.dirsource)is=!!rawvalue.text();else is=input.length?!!input[0].value:!!self.get();if(binded===is)return;binded=is;placeholder&&placeholder.tclass('hidden',is);self.tclass(cls+'-binded',is);if(config.type==='search')self.find(cls2+'-icon-'+(config.searchalign===1?'right':'left')).find('i').tclass(config.searchalign===1?config.ricon:config.licon,!is).tclass('fa-times',is)};self.bindvalue=function(){var value=self.get();if(dirsource){var item;for(var i=0;i<dirsource.length;i++){item=dirsource[i];if(typeof(item)==='string'){if(item===value)break;item=null}else if(item[config.dirvalue||config.value]===value){item=item[config.dirkey||config.key];break}else item=null}if(value&&item==null&&config.dircustom)item=value;if(config.dirraw)rawvalue.html(item||'');else rawvalue.text(item||'')}else if(config.dirsource)if(config.dirraw)rawvalue.html(value||'');else rawvalue.text(value||'');else{switch(config.type){case'color':rawvalue.css('background-color',value||'');break;case'icon':rawvalue.html('<i class="{0}"></i>'.format(value||''));break;case'emoji':rawvalue.html(value);break}}self.check()};self.redraw=function(){if(!config.ricon){if(config.dirsource)config.ricon='angle-down';else if(config.type==='date'){config.ricon='calendar';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='icon'||config.type==='color'||config.type==='emoji'){config.ricon='angle-down';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='time'){config.ricon='clock-o';if(!config.align&&!config.innerlabel)config.align=1}else if(config.type==='search')if(config.searchalign===1)config.ricon='search';else config.licon='search';else if(config.type==='password')config.ricon='eye';else if(config.type==='number'){if(!config.align&&!config.innerlabel)config.align=1}}self.tclass(cls+'-masked',!!config.mask);self.rclass2(cls+'-type-');if(config.type)self.aclass(cls+'-type-'+config.type);self.html(W.ui_input_template(config));input=self.find('input');rawvalue=self.find(cls2+'-value');placeholder=self.find(cls2+'-placeholder')};self.configure=function(key,value){switch(key){case'icon':if(value&&value.indexOf(' ')===-1)config.icon='fa fa-'+value;break;case'dirsource':if(config.dirajax||value.indexOf('/')!==-1){dirsource=null;self.bindvalue()}else{if(value.indexOf(',')!==-1){dirsource=self.parsesource(value);self.bindvalue()}else{self.datasource(value,function(path,value){dirsource=value;self.bindvalue()})}}self.tclass(cls+'-dropdown',!!value);input.prop('readonly',!!config.disabled||!!config.dirsource);break;case'disabled':self.tclass('ui-disabled',!!value);input.prop('readonly',!!value||!!config.dirsource);self.reset();break;case'required':self.tclass(cls+'-required',!!value);self.reset();break;case'type':self.type=value;break;case'validate':customvalidator=value?(/\(|=|>|<|\+|-|\)/).test(value)?FN('value=>'+value):(function(path){path=self.makepath(path);return function(value){return GET(path)(value)}})(value):null;break;case'innerlabel':self.tclass(cls+'-inner',!!value);break;case'monospace':self.tclass(cls+'-monospace',!!value);break;case'maskregexp':if(value){mask=value.toLowerCase().split(',');for(var i=0;i<mask.length;i++){var m=mask[i];if(!m||m==='null')mask[i]='';else mask[i]=new RegExp(m)}}else mask=null;break;case'mask':config.mask=value.replace(/#/g,'_');break}};self.formatter(function(path,value){if(value){switch(config.type){case'lower':return(value+'').toLowerCase();case'upper':return(value+'').toUpperCase();case'phone':return(value+'').replace(/\s/g,'');case'email':return(value+'').toLowerCase();case'date':return value.format(config.format||DEF.dateformat||'yyyy-MM-dd');case'time':return value.format(config.format||'HH:mm');case'number':return config.format?value.format(config.format):value}}return value});self.parser(function(path,value){if(value){var tmp;switch(config.type){case'date':tmp=self.get();if(tmp)tmp=tmp.format('HH:mm');else tmp='';return value+(tmp?(' '+tmp):'');case'lower':case'email':value=value.toLowerCase();break;case'upper':value=value.toUpperCase();break;case'phone':value=value.replace(/\s/g,'');break;case'time':tmp=value.split(':');var dt=self.get();value=dt?new Date(dt.getTime()):new Date();value.setHours((tmp[0]||'0').parseInt());value.setMinutes((tmp[1]||'0').parseInt());value.setSeconds((tmp[2]||'0').parseInt());break}}return value?config.spaces===false?value.replace(/\s/g,''):value:value});self.state=function(type,what){if(type){if(type===1&&what===4){self.rclass(cls+'-ok '+cls+'-invalid');self.$oldstate=null;return}var invalid=config.required?self.isInvalid():self.forcedvalidation()?self.isInvalid():false;if(invalid!==self.$oldstate){self.$oldstate=invalid;self.tclass(cls+'-invalid',invalid);self.tclass(cls+'-ok',!invalid);config.error&&self.find(cls2+'-error').tclass('hidden',!invalid)}}};self.forcedvalidation=function(){if(!config.forcevalidation)return false;if(self.type==='number')return false;var val=self.get();return(self.type==='phone'||self.type==='email')&&(val!=null&&(typeof(val)==='string'&&val.length!==0))}});
// End: j-Input

// Component: Tangular-Color
// Version: 1
// Updated: 2020-02-20 16:37
Thelpers.color=function(value){var hash=HASH(value,true);var color='#';for(var i=0;i<3;i++){var value=(hash>>(i*8))&0xFF;color+=('00'+value.toString(16)).substr(-2)}return color};
// End: Tangular-Color

// Component: j-Shortcuts
// Version: 1
// Updated: 2020-07-30 15:25
COMPONENT('shortcuts',function(self){var items=[],length=0,keys={},keys_session={},issession=false;self.singleton();self.readonly();self.blind();self.nocompile&&self.nocompile();var cb=function(o,e){o.callback(e,o.owner)};self.make=function(){$(W).on('keydown',function(e){var f=e.key,c=e.keyCode;if(f.length>1&&f.charAt(0)==='F')c=0;else f='-';var key=(e.ctrlKey?1:0)+''+(e.altKey?1:0)+''+(e.shiftKey?1:0)+''+(e.metaKey?1:0)+f+c;if(issession){if(!keys_session[key])return}else{if(!keys[key])return}if(length&&!e.isPropagationStopped()){for(var i=0;i<length;i++){var o=items[i];if(o.fn(e)){if(o.prevent){e.preventDefault();e.stopPropagation()}setTimeout(cb,100,o,e);return}}}});ON('component + knockknock',self.refresh)};self.refreshforce=function(){var arr=document.querySelectorAll('.shortcut');var index=0;while(true){var item=items[index++];if(item==null)break;if(item.owner){index--;items.splice(index,1)}}for(var i=0;i<arr.length;i++){var shortcut=arr[i].getAttribute('data-shortcut');shortcut&&self.register(shortcut,self.execshortcut,true,arr[i])}};self.session=function(callback){issession=true;keys_session={};callback(self.register)};self.end=function(){issession=false};self.execshortcut=function(e,owner){$(owner).trigger('click')};self.refresh=function(){setTimeout2(self.ID,self.refreshforce,500)};self.exec=function(shortcut){var item=items.findItem('shortcut',shortcut.toLowerCase().replace(/\s/g,''));item&&item.callback(EMPTYOBJECT,item.owner)};self.register=function(shortcut,callback,prevent,owner){var currentkeys=issession?keys_session:keys;shortcut.split(',').trim().forEach(function(shortcut){var builder=[],alias=[],cachekey=[0,0,0,0,'-',0];shortcut.split('+').trim().forEach(function(item){var lower=item.toLowerCase();alias.push(lower);switch(lower){case'ctrl':cachekey[0]=1;break;case'alt':cachekey[1]=1;break;case'shift':cachekey[2]=1;break;case'win':case'meta':case'cmd':cachekey[3]=1;break}switch(lower){case'ctrl':case'alt':case'shift':builder.push('e.{0}Key'.format(lower));return;case'win':case'meta':case'cmd':builder.push('e.metaKey');return;case'ins':builder.push('e.keyCode===45');cachekey[5]=45;return;case'space':builder.push('e.keyCode===32');cachekey[5]=32;return;case'tab':builder.push('e.keyCode===9');cachekey[5]=9;return;case'esc':builder.push('e.keyCode===27');cachekey[5]=27;return;case'enter':builder.push('e.keyCode===13');cachekey[5]=13;return;case'backspace':builder.push('e.keyCode===8');cachekey[5]=8;break;case'del':case'delete':builder.push('e.keyCode===46');cachekey[5]=46;return;case'save':builder.push('(e.metaKey&&e.keyCode===115)');cachekey[5]=-1;return;case'remove':builder.push('((e.metaKey&&e.keyCode===8)||e.keyCode===46)');cachekey[5]=-1;return;case'up':builder.push('e.keyCode===38');cachekey[5]=38;return;case'down':builder.push('e.keyCode===40');cachekey[5]=40;return;case'right':builder.push('e.keyCode===39');cachekey[5]=39;return;case'left':builder.push('e.keyCode===37');cachekey[5]=37;return;case'f1':case'f2':case'f3':case'f4':case'f5':case'f6':case'f7':case'f8':case'f9':case'f10':case'f11':case'f12':var a=item.toUpperCase();builder.push('e.key===\'{0}\''.format(a));cachekey[4]=a;return;case'capslock':builder.push('e.which===20');cachekey[5]=20;return}var num=item.parseInt();if(num){builder.push('e.which==='+num);cachekey[5]=num}else{num=item.toUpperCase().charCodeAt(0);cachekey[5]=num;builder.push('e.keyCode==={0}'.format(num))}});items.push({shortcut:alias.join('+'),fn:new Function('e','return '+builder.join('&&')),callback:callback,prevent:prevent,owner:owner});length=items.length;var k;if(cachekey[5]===-1){cachekey[5]=8;k=cachekey.join('');currentkeys[k]=1;cachekey[5]=46}k=cachekey.join('');currentkeys[k]=1});if(!owner)self.refresh();return self}});
// End: j-Shortcuts

// Component: j-Message
// Version: 1
// Updated: 2021-04-20 15:52
COMPONENT('message','button:OK',function(self,config,cls){var cls2='.'+cls,is,events={};self.readonly();self.singleton();self.nocompile&&self.nocompile();self.make=function(){var pls=(config.style===2?(' '+cls+'2'):'');self.aclass(cls+' hidden'+pls);if(config.closeoutside)self.event('click',function(e){var node=e.target,skip={SPAN:1,A:1,I:1};if(!skip[node.tagName])self.hide()});else self.event('click','button',self.hide)};events.keyup=function(e){if(e.which===27)self.hide()};events.bind=function(){if(!events.is){$(W).on('keyup',events.keyup);events.is=false}};events.unbind=function(){if(events.is){events.is=false;$(W).off('keyup',events.keyup)}};self.warning=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content(cls+'-warning',message,icon||'warning')};self.info=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content(cls+'-info',message,icon||'info-circle')};self.success=function(message,icon,fn){if(typeof(icon)==='function'){fn=icon;icon=undefined}self.callback=fn;self.content(cls+'-success',message,icon||'check-circle')};self.response=function(message,callback,response){var fn;if(typeof(message)==='function'){response=callback;fn=message;message=null}else if(typeof(callback)==='function')fn=callback;else{response=callback;fn=null}if(response instanceof Array){var builder=[];for(var i=0;i<response.length;i++){var err=response[i].error;err&&builder.push(err)}self.warning(builder.join('<br />'));SETTER('!loading/hide')}else if(typeof(response)==='string'){self.warning(response);SETTER('!loading/hide')}else{if(message){if(message.length<40&&message.charAt(0)==='?')SET(message,response);else self.success(message)}if(typeof(fn)==='string')SET(fn,response);else if(fn)fn(response)}};self.hide=function(){events.unbind();self.callback&&self.callback();self.aclass('hidden')};self.content=function(classname,text,icon){if(icon.indexOf(' ')===-1)icon='fa fa-'+icon;!is&&self.html('<div><div class="{0}-icon"><i class="{1}"></i></div><div class="{0}-body"><div class="{0}-text"></div><hr /><button>{2}</button></div></div>'.format(cls,icon,config.button));self.rclass2(cls+'-').aclass(classname);self.find(cls2+'-body').rclass().aclass(cls+'-body');is&&self.find(cls2+'-icon').find('.fa').rclass2('fa').aclass(icon);self.find(cls2+'-text').html(text);self.rclass('hidden');self.element.focus();is=true;events.bind();document.activeElement&&document.activeElement.blur();setTimeout(function(){self.aclass(cls+'-visible');setTimeout(function(){self.find(cls2+'-icon').aclass(cls+'-icon-animate');document.activeElement&&document.activeElement.blur()},300)},100)}});
// End: j-Message

// Component: j-Clipboard
// Version: 1
// Updated: 2019-01-07 23:56
COMPONENT('clipboard',function(self){var container;self.singleton();self.readonly();self.nocompile&&self.nocompile();self.copy=function(value){container.val(value);container.focus();container.select();document.execCommand('copy');container.blur()};self.make=function(){var id='clipboard'+self.id;$(document.body).append('<textarea id="{0}" class="ui-clipboard"></textarea>'.format(id));container=$('#'+id)};self.setter=function(value){value&&self.copy(value)}});
// End: j-Clipboard